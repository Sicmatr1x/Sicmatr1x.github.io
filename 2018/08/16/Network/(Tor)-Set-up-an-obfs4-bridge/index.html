<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>(Tor) Set up an obfs4 bridge | Sicmatr1x's Blog</title><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"键入以继续","blurHolder":"数据检索","noResult":"无 $0 相关数据"},"code":{"codeInfo":"$0 - 共 $1 行","copy":"复制","copyFinish":"复制成功","expand":"展开"}}</script><script src="/js/gitalk.js"></script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Sicmatr1x's Blog" type="application/atom+xml">
</head><body><div class="loading" style="opacity: 0"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn hide"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/toolkit/"><span class="navItemTitle">Toolkit</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>(Tor) Set up an obfs4 bridge</h1><div id="post-info"><span>文章发布时间: <div class="control"><time datetime="2018-08-16T02:39:13.000Z" id="date"> 2018-08-16</time></div></span><br><span>最后更新时间: <div class="control"><time datetime="2023-03-25T16:00:00.000Z" id="updated"> 2023-03-26</time></div></span></div></div><hr><div id="post-content"><h2 id="Bridge-set-up-guide"><a href="#Bridge-set-up-guide" class="headerlink" title="Bridge set up guide"></a><a href="community.torproject.org/relay/setup/bridge/">Bridge set up guide</a></h2><p>This guide will help you set up an obfs4 bridge to help censored users connect to the Tor network. The requirements are:</p>
<pre><code>24/7 Internet connectivity
The ability to expose TCP ports to the Internet (make sure that NAT doesn&#39;t get in the way)
</code></pre>
<p>Note: If you’re running a platform that is not listed on this page, you can <a target="_blank" rel="noopener" href="https://gitlab.com/yawning/obfs4#installation">compile obfs4 from source</a>.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://community.torproject.org/relay/setup/bridge/debian-ubuntu/">Debian &#x2F; Ubuntu</a>: How to deploy an obfs4 bridge on Debian &#x2F; Ubuntu</li>
<li><a target="_blank" rel="noopener" href="https://community.torproject.org/relay/setup/bridge/windows/">Windows</a>: How to deploy an obfs4 bridge on Windows</li>
<li><a target="_blank" rel="noopener" href="https://community.torproject.org/relay/setup/bridge/fedora/">Fedora</a>: How to deploy an obfs4 bridge on Fedora</li>
<li><a target="_blank" rel="noopener" href="https://community.torproject.org/relay/setup/bridge/centos-rhel-opensuse/">CentOS &#x2F; RHEL &#x2F; OpenSUSE</a>: How to deploy an obfs4 bridge on CentOS &#x2F; RHEL &#x2F; OpenSUSE</li>
<li><a target="_blank" rel="noopener" href="https://community.torproject.org/relay/setup/bridge/dragonflybsd/">DragonflyBSD</a>: How to deploy an obfs4 bridge on DragonflyBSD</li>
<li><a target="_blank" rel="noopener" href="https://community.torproject.org/relay/setup/bridge/docker/">Docker</a>: How to deploy an obfs4 bridge using a docker container</li>
<li><a target="_blank" rel="noopener" href="https://community.torproject.org/relay/setup/bridge/post-install/">Post-install</a>: How to find your bridge in Relay Search and connect manually</li>
<li><a target="_blank" rel="noopener" href="https://community.torproject.org/relay/setup/bridge/netbsd/">NetBSD</a>: How to deploy an obfs4 bridge on NetBSD</li>
</ul>
<h2 id="Set-up-bridge-by-using-Docker"><a href="#Set-up-bridge-by-using-Docker" class="headerlink" title="Set up bridge by using Docker"></a>Set up bridge by using Docker</h2><h3 id="1-Deploy-a-container"><a href="#1-Deploy-a-container" class="headerlink" title="1. Deploy a container"></a>1. Deploy a container</h3><p>We provide a docker-compose file that helps you deploy the container. First, download docker-compose.yml: </p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># This file assists operators in (re-)deploying an obfs4 bridge Docker</span><br><span class="hljs-comment"># container.  You need the tool &#x27;docker-compose&#x27; to use this file.  You</span><br><span class="hljs-comment"># can find it in the Debian package &#x27;docker-compose&#x27;.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># First, you need to create a configuration file, &quot;.env&quot;, in the same directory</span><br><span class="hljs-comment"># as this file, &quot;docker-compose.yml&quot;.  Add the following environment variables</span><br><span class="hljs-comment"># to this configuration file.  EMAIL is your email address; OR_PORT is your</span><br><span class="hljs-comment"># onion routing port; and PT_PORT is your obfs4 port:</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   EMAIL=you@example.com</span><br><span class="hljs-comment">#   OR_PORT=XXX</span><br><span class="hljs-comment">#   PT_PORT=XXX</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Next, pull the Docker image, by running:</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   docker-compose pull obfs4-bridge</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># And finally, to (re-)deploy the container, run:</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   docker-compose up -d obfs4-bridge</span><br><br><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3.4&quot;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">obfs4-bridge:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">thetorproject/obfs4-bridge:latest</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-comment"># Exit with an error message if OR_PORT is unset or empty.</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">OR_PORT=$&#123;OR_PORT:?Env</span> <span class="hljs-string">var</span> <span class="hljs-string">OR_PORT</span> <span class="hljs-string">is</span> <span class="hljs-string">not</span> <span class="hljs-string">set.&#125;</span><br>      <span class="hljs-comment"># Exit with an error message if PT_PORT is unset or empty.</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">PT_PORT=$&#123;PT_PORT:?Env</span> <span class="hljs-string">var</span> <span class="hljs-string">PT_PORT</span> <span class="hljs-string">is</span> <span class="hljs-string">not</span> <span class="hljs-string">set.&#125;</span><br>      <span class="hljs-comment"># Exit with an error message if EMAIL is unset or empty.</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">EMAIL=$&#123;EMAIL:?Env</span> <span class="hljs-string">var</span> <span class="hljs-string">EMAIL</span> <span class="hljs-string">is</span> <span class="hljs-string">not</span> <span class="hljs-string">set.&#125;</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">data:/var/lib/tor</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">$&#123;OR_PORT&#125;:$&#123;OR_PORT&#125;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">$&#123;PT_PORT&#125;:$&#123;PT_PORT&#125;</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br><br><span class="hljs-attr">volumes:</span><br>  <span class="hljs-attr">data:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">tor-datadir-$&#123;OR_PORT&#125;-$&#123;PT_PORT&#125;</span><br></code></pre></td></tr></table></figure>

<p>and then write your bridge configuration to a new file, <code>.env</code>, which is in the same directory as <code>docker-compose.yml</code>. Here’s a template:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"># Your bridge&#x27;s Tor port.<br>OR_PORT=X<br># Your bridge&#x27;s obfs4 port.<br>PT_PORT=Y<br># Your email address.<br>EMAIL=Z<br></code></pre></td></tr></table></figure>

<p>Replace <code>X</code> with your desired OR port, <code>Y</code> with your obfs4 port (make sure that <strong>both</strong> ports are forwarded in your firewall), and <code>Z</code> with your email address, which allows us to get in touch with you if there are problems with your bridge. With your bridge configuration in place, you can now deploy the container by running:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">docker-compose up -d obfs4-bridge<br></code></pre></td></tr></table></figure>

<p>This command will automatically load your docker-compose.yml file while considering the environment variables in <code>.env</code>.</p>
<p>You should now see output similar to the following:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Starting docker-obfs4-bridge_obfs4-bridge_1 ... done<br></code></pre></td></tr></table></figure>

<p>That’s it! Your container is now bootstrapping your new obfs4 bridge.</p>
<h3 id="2-Upgrade-your-container"><a href="#2-Upgrade-your-container" class="headerlink" title="2. Upgrade your container"></a>2. Upgrade your container</h3><p>Upgrading to the latest version of our image is as simple as running:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">docker-compose up -d obfs4-bridge<br></code></pre></td></tr></table></figure>

<p>Note that your bridge’s data directory (which includes its key material) is stored in a docker volume, so you won’t lose your bridge’s identity when upgrading to the latest docker image. If you are running multiple bridges on your computer, you need to repeat this step for each bridge. We will announce new image versions on the <a target="_blank" rel="noopener" href="https://lists.torproject.org/cgi-bin/mailman/listinfo/tor-dev">tor-dev</a> mailing list.</p>
<h3 id="3-Monitor-your-logs"><a href="#3-Monitor-your-logs" class="headerlink" title="3. Monitor your logs"></a>3. Monitor your logs</h3><p>You can inspect your bridge’s logs by running:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">docker logs CONTAINER_ID<br></code></pre></td></tr></table></figure>

<p>To use your new bridge in Tor Browser, you need its “bridge line”. Here’s how you can get your bridge line:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">docker exec CONTAINER_ID get-bridge-line<br></code></pre></td></tr></table></figure>

<p>This will return a string similar to the following:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">obfs4 1.2.3.4:1234 B0E566C9031657EA7ED3FC9D248E8AC4F37635A4 cert=OYWq67L7MDApdJCctUAF7rX8LHvMxvIBPHOoAp0+YXzlQdsxhw6EapaMNwbbGICkpY8CPQ iat-mode=0<br></code></pre></td></tr></table></figure>

<p>Make sure to check out the <strong>post-install notes</strong>. If you are having troubles setting up your bridge, have a look at <strong>our help section</strong>.</p>
<h4 id="post-install-notes"><a href="#post-install-notes" class="headerlink" title="post-install notes"></a><a target="_blank" rel="noopener" href="https://community.torproject.org/relay/setup/bridge/post-install/">post-install notes</a></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Congrats!<br><br>If you get to this point, it means that your obfs4 bridge is running and is being distributed by BridgeDB to censored users. Note that it can take several days or weeks until you see a consistent set of users, so don&#x27;t get discouraged if you don&#x27;t see user connections right away. BridgeDB uses four buckets for bridge distribution: HTTPS, Moat, Email, and manual. Some buckets are used more than others, which also affects the time until your bridge sees users. Finally, there aren&#x27;t many bridge users out there, so you cannot expect your bridge to be as popular as a relay.<br><br>If you want to connect to your bridge manually, you will need to know the bridge&#x27;s obfs4 certificate. See the file /var/lib/tor/pt_state/obfs4_bridgeline.txt and paste the entire bridge line into Tor Browser:<br><br>Bridge obfs4 &lt;IP ADDRESS&gt;:&lt;PORT&gt; &lt;FINGERPRINT&gt; cert=&lt;CERTIFICATE&gt; iat-mode=0<br>You&#x27;ll need to replace &lt;IP ADDRESS&gt;, &lt;PORT&gt;, and &lt;FINGERPRINT&gt; with the actual values, which you can find in the tor log. Make sure to use &lt;FINGERPRINT&gt;, not &lt;HASHED FINGERPRINT&gt;; and that &lt;PORT&gt; is the obfs4 port you chose - and not the OR port.<br><br>Finally, you can monitor your obfs4 bridge&#x27;s usage on Relay Search. Just enter your bridge&#x27;s &lt;HASHED FINGERPRINT&gt; in the form and click &quot;Search&quot;. After having set up the bridge, it takes approximately three hours for the bridge to show up in Relay Search.<br></code></pre></td></tr></table></figure>

<h4 id="our-help-section"><a href="#our-help-section" class="headerlink" title="our help section"></a><a target="_blank" rel="noopener" href="https://community.torproject.org/relay/getting-help/">our help section</a></h4><p>If you run into problems while setting up your relay, you can ask your questions on the public <a target="_blank" rel="noopener" href="https://lists.torproject.org/cgi-bin/mailman/listinfo/tor-relays">tor-relays mailing list</a>. The list is a great resource for asking (and answering) questions, and for getting to know other relay operators. Make sure to check out the archives!</p>
<p>You can also get help by joining the IRC channel #tor-relays in the network <a target="_blank" rel="noopener" href="https://support.torproject.org/get-in-touch/#irc-help">irc.oftc.net</a>.</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2018/08/16/Buffer/hexo-%E4%B8%8A%E4%BD%BF%E7%94%A8highlight-js%E4%BB%A3%E7%A0%81%E9%AB%98%E4%BA%AE/">← Next hexo 上使用highlight.js代码高亮</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2018/08/15/Database/Oracle/Oracle-Database/">Oracle Database Prev →</a></div></div></div><div id="comments"><div class="selector"><button class="gitalk-sel"></button></div><div id="gitalk"></div></div></div><div class="bottom-btn"><div><a id="to-top" onClick="scrolls.scrolltop();" title="回到顶部" style="opacity: 0; display: none;">∧</a><a id="to-index" href="#toc-div" title="文章目录">≡</a><a id="color-mode" onClick="colorMode.change()" title="切换主题"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">Sicmatr1x</a></h1><div id="description"><p>INTP/Traveller/Stoicism/Crypto-anarchism/Minimalism/Cosmopolitanism/English learner/Crypto/Java Engineer</p></div></div><div id="aside-block"><div id="toc-div"><h1>目录</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Bridge-set-up-guide"><span class="toc-number">1.</span> <span class="toc-text">Bridge set up guide</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Set-up-bridge-by-using-Docker"><span class="toc-number">2.</span> <span class="toc-text">Set up bridge by using Docker</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Deploy-a-container"><span class="toc-number">2.1.</span> <span class="toc-text">1. Deploy a container</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Upgrade-your-container"><span class="toc-number">2.2.</span> <span class="toc-text">2. Upgrade your container</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Monitor-your-logs"><span class="toc-number">2.3.</span> <span class="toc-text">3. Monitor your logs</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#post-install-notes"><span class="toc-number">2.3.1.</span> <span class="toc-text">post-install notes</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#our-help-section"><span class="toc-number">2.3.2.</span> <span class="toc-text">our help section</span></a></li></ol></li></ol></li></ol></div></div><footer><nobr>构建自 <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> 使用主题 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>主题作者 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script class="pjax-js">reset=_=>{gitalk = new Gitalk({
 clientID: '',
 clientSecret: '',
 repo: 'blog-comments',
 owner: 'Sicmatr1x',
 admin: ['Sicmatr1x'],
 distractionFreeMode: false,
 id: 
});
if (document.querySelector("#gitalk")) gitalk.render("gitalk");code.findCode();}</script><script src="/js/arknights.js"></script><script src="/js/pjax.js"></script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>