<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Oracle PL | Sicmatr1x's Blog</title><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"键入以继续","blurHolder":"数据检索","noResult":"无 $0 相关数据"},"code":{"codeInfo":"$0 - 共 $1 行","copy":"复制","copyFinish":"复制成功","expand":"展开"}}</script><script src="/js/gitalk.js"></script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Sicmatr1x's Blog" type="application/atom+xml">
</head><body><div class="loading" style="opacity: 0"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn hide"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/toolkit/"><span class="navItemTitle">Toolkit</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>Oracle PL</h1><div id="post-info"><span>文章发布时间: <div class="control"><time datetime="2017-07-30T13:31:43.000Z" id="date"> 2017-07-30</time></div></span><br><span>最后更新时间: <div class="control"><time datetime="2023-03-26T09:08:19.764Z" id="updated"> 2023-03-26</time></div></span></div></div><hr><div id="post-content"><h2 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h2><p>特点：</p>
<ol>
<li>模块化</li>
<li>过程化</li>
<li>提高操作性能，减少网络传输</li>
<li>错误处理</li>
</ol>
<p>分类：</p>
<ol>
<li>匿名块</li>
<li>存储过程(procedure)</li>
<li>函数(function)</li>
<li>包(package)</li>
<li>触发器(trigger)</li>
</ol>
<h2 id="编写-PL-x2F-SQL"><a href="#编写-PL-x2F-SQL" class="headerlink" title="编写 PL&#x2F;SQL"></a>编写 PL&#x2F;SQL</h2><h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><p>PL&#x2F;SQL由三部分组成：</p>
<ol>
<li>定义部分</li>
<li>可执行部分</li>
<li>例外处理部分</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 定义部分</span><br><span class="hljs-keyword">declare</span><br><br><span class="hljs-comment">-- 可执行部分</span><br><span class="hljs-keyword">Begin</span><br><br><span class="hljs-comment">-- 例外处理部分</span><br>exception<br><br><span class="hljs-keyword">End</span>;<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">--example:</span><br><span class="hljs-keyword">select</span> first_name, email,salary<br><span class="hljs-keyword">from</span> employees<br><span class="hljs-keyword">where</span> employee_id<span class="hljs-operator">=</span><span class="hljs-operator">&amp;</span>员工编号;<br><span class="hljs-comment">-- 改写成为程序：</span><br><span class="hljs-keyword">set</span> serveroutput <span class="hljs-keyword">on</span> <span class="hljs-comment">-- 在本次会话中开启系统输出显示</span><br><span class="hljs-comment">-- 定义部分</span><br><span class="hljs-keyword">declare</span><br>    v_name varchar2(<span class="hljs-number">20</span>);<br>    v_email varchar2(<span class="hljs-number">25</span>);<br>    v_sal number(<span class="hljs-number">8</span>,<span class="hljs-number">2</span>);<br><span class="hljs-keyword">begin</span><span class="hljs-comment">-- 可执行部分</span><br>    <span class="hljs-keyword">select</span> first_name, email,salary<br>    <span class="hljs-keyword">into</span> v_name, v_email, v_sal<br>    <span class="hljs-keyword">from</span> employees<br>    <span class="hljs-keyword">where</span> employee_id<span class="hljs-operator">=</span><span class="hljs-operator">&amp;</span>员工编号;<br>    dbms_output.put_line(<span class="hljs-string">&#x27;姓名&#x27;</span><span class="hljs-operator">||</span>v_name<span class="hljs-operator">||</span><span class="hljs-string">&#x27;邮箱&#x27;</span><span class="hljs-operator">||</span>v_email<span class="hljs-operator">||</span><span class="hljs-string">&#x27;工资&#x27;</span><span class="hljs-operator">||</span>v_sal);<br>exception <span class="hljs-comment">-- 例外处理部分(异常处理)</span><br>    <span class="hljs-keyword">when</span> no_data_found <span class="hljs-keyword">then</span><br>        dbms_output.put_line(<span class="hljs-string">&#x27;您输入的工号不存在&#x27;</span>);<br>    <span class="hljs-keyword">when</span> others <span class="hljs-keyword">then</span><br>        dbms_output.put_line(sqlerrm);<span class="hljs-comment">--sqlerrm是系统显示异常的变量</span><br><span class="hljs-keyword">end</span>;<br></code></pre></td></tr></table></figure>

<h4 id="无参数返回值函数样例"><a href="#无参数返回值函数样例" class="headerlink" title="无参数返回值函数样例"></a>无参数返回值函数样例</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 计算个人所得税</span><br><span class="hljs-keyword">declare</span><br>    v_salary number(<span class="hljs-number">8</span>,<span class="hljs-number">2</span>):<span class="hljs-operator">=</span><span class="hljs-operator">&amp;</span>工资;<br>    v_shouldTaxedNum number(<span class="hljs-number">8</span>,<span class="hljs-number">2</span>);<br>    v_taxed number(<span class="hljs-number">8</span>,<span class="hljs-number">2</span>);<br><span class="hljs-keyword">begin</span><br>    v_shouldTaxedNum :<span class="hljs-operator">=</span> v_salary <span class="hljs-operator">-</span> <span class="hljs-number">3500</span>;<br>    if v_shouldTaxedNum <span class="hljs-operator">&lt;=</span> <span class="hljs-number">0</span> <span class="hljs-keyword">then</span><br>        v_taxed :<span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    elsif v_shouldTaxedNum <span class="hljs-operator">&lt;=</span> <span class="hljs-number">1500</span> <span class="hljs-keyword">then</span><br>        v_taxed :<span class="hljs-operator">=</span> v_shouldTaxedNum<span class="hljs-operator">*</span><span class="hljs-number">0.03</span><span class="hljs-number">-0</span>;<br>    elsif v_shouldTaxedNum <span class="hljs-operator">&lt;=</span> <span class="hljs-number">4500</span> <span class="hljs-keyword">then</span><br>        v_taxed :<span class="hljs-operator">=</span> v_shouldTaxedNum<span class="hljs-operator">*</span><span class="hljs-number">0.1</span><span class="hljs-number">-105</span>;<br>    elsif v_shouldTaxedNum <span class="hljs-operator">&lt;=</span> <span class="hljs-number">9000</span> <span class="hljs-keyword">then</span><br>        v_taxed :<span class="hljs-operator">=</span> v_shouldTaxedNum<span class="hljs-operator">*</span><span class="hljs-number">0.2</span><span class="hljs-number">-555</span>;<br>    elsif v_shouldTaxedNum <span class="hljs-operator">&lt;=</span> <span class="hljs-number">35000</span> <span class="hljs-keyword">then</span><br>        v_taxed :<span class="hljs-operator">=</span> v_shouldTaxedNum<span class="hljs-operator">*</span><span class="hljs-number">0.25</span><span class="hljs-number">-1005</span>;<br>    elsif v_shouldTaxedNum <span class="hljs-operator">&lt;=</span> <span class="hljs-number">55000</span> <span class="hljs-keyword">then</span><br>        v_taxed :<span class="hljs-operator">=</span> v_shouldTaxedNum<span class="hljs-operator">*</span><span class="hljs-number">0.3</span><span class="hljs-number">-2755</span>;<br>    elsif v_shouldTaxedNum <span class="hljs-operator">&lt;=</span> <span class="hljs-number">80000</span> <span class="hljs-keyword">then</span><br>        v_taxed :<span class="hljs-operator">=</span> v_shouldTaxedNum<span class="hljs-operator">*</span><span class="hljs-number">0.35</span><span class="hljs-number">-5505</span>;<br>    <span class="hljs-keyword">else</span><br>        v_taxed :<span class="hljs-operator">=</span> v_shouldTaxedNum<span class="hljs-operator">*</span><span class="hljs-number">0.45</span><span class="hljs-number">-13505</span>;<br>    <span class="hljs-keyword">end</span> if;<br>    dbms_output.put_line(<span class="hljs-string">&#x27;v_taxed=&#x27;</span><span class="hljs-operator">||</span>v_taxed);<br><span class="hljs-keyword">end</span>;<br></code></pre></td></tr></table></figure>

<h4 id="有参数返回值函数样例"><a href="#有参数返回值函数样例" class="headerlink" title="有参数返回值函数样例"></a>有参数返回值函数样例</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> replace <span class="hljs-keyword">function</span> f_tax(v_salary <span class="hljs-keyword">in</span> number)<br><span class="hljs-keyword">return</span> number<br><span class="hljs-keyword">as</span><br>    v_shouldTaxedNum number(<span class="hljs-number">8</span>,<span class="hljs-number">2</span>);<br>    v_taxed number(<span class="hljs-number">8</span>,<span class="hljs-number">2</span>);<br><span class="hljs-keyword">begin</span><br>    v_shouldTaxedNum :<span class="hljs-operator">=</span> v_salary <span class="hljs-operator">-</span> <span class="hljs-number">3500</span>;<br>    if v_shouldTaxedNum <span class="hljs-operator">&lt;=</span> <span class="hljs-number">0</span> <span class="hljs-keyword">then</span><br>        v_taxed :<span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    elsif v_shouldTaxedNum <span class="hljs-operator">&lt;=</span> <span class="hljs-number">1500</span> <span class="hljs-keyword">then</span><br>        v_taxed :<span class="hljs-operator">=</span> v_shouldTaxedNum<span class="hljs-operator">*</span><span class="hljs-number">0.03</span><span class="hljs-number">-0</span>;<br>    elsif v_shouldTaxedNum <span class="hljs-operator">&lt;=</span> <span class="hljs-number">4500</span> <span class="hljs-keyword">then</span><br>        v_taxed :<span class="hljs-operator">=</span> v_shouldTaxedNum<span class="hljs-operator">*</span><span class="hljs-number">0.1</span><span class="hljs-number">-105</span>;<br>    elsif v_shouldTaxedNum <span class="hljs-operator">&lt;=</span> <span class="hljs-number">9000</span> <span class="hljs-keyword">then</span><br>        v_taxed :<span class="hljs-operator">=</span> v_shouldTaxedNum<span class="hljs-operator">*</span><span class="hljs-number">0.2</span><span class="hljs-number">-555</span>;<br>    elsif v_shouldTaxedNum <span class="hljs-operator">&lt;=</span> <span class="hljs-number">35000</span> <span class="hljs-keyword">then</span><br>        v_taxed :<span class="hljs-operator">=</span> v_shouldTaxedNum<span class="hljs-operator">*</span><span class="hljs-number">0.25</span><span class="hljs-number">-1005</span>;<br>    elsif v_shouldTaxedNum <span class="hljs-operator">&lt;=</span> <span class="hljs-number">55000</span> <span class="hljs-keyword">then</span><br>        v_taxed :<span class="hljs-operator">=</span> v_shouldTaxedNum<span class="hljs-operator">*</span><span class="hljs-number">0.3</span><span class="hljs-number">-2755</span>;<br>    elsif v_shouldTaxedNum <span class="hljs-operator">&lt;=</span> <span class="hljs-number">80000</span> <span class="hljs-keyword">then</span><br>        v_taxed :<span class="hljs-operator">=</span> v_shouldTaxedNum<span class="hljs-operator">*</span><span class="hljs-number">0.35</span><span class="hljs-number">-5505</span>;<br>    <span class="hljs-keyword">else</span><br>        v_taxed :<span class="hljs-operator">=</span> v_shouldTaxedNum<span class="hljs-operator">*</span><span class="hljs-number">0.45</span><span class="hljs-number">-13505</span>;<br>    <span class="hljs-keyword">end</span> if;<br>    <span class="hljs-keyword">return</span> v_taxed;<br><span class="hljs-keyword">end</span>;<br><span class="hljs-operator">/</span><br><span class="hljs-keyword">show</span> error;<span class="hljs-comment">/*如果编译出现错误则显示错误信息*/</span><br><br><span class="hljs-comment">-- 在查询语句中调用函数</span><br><span class="hljs-keyword">select</span> employee_id, nvl(salary,<span class="hljs-number">0</span>)<span class="hljs-operator">+</span>nvl(salary,<span class="hljs-number">0</span>)<span class="hljs-operator">*</span>nvl(commission_pct,<span class="hljs-number">0</span>) sal, f_tax(nvl(salary,<span class="hljs-number">0</span>)<span class="hljs-operator">+</span>nvl(salary,<span class="hljs-number">0</span>)<span class="hljs-operator">*</span>nvl(commission_pct,<span class="hljs-number">0</span>)) tax<br><span class="hljs-keyword">from</span> employees;<br></code></pre></td></tr></table></figure>

<h4 id="规范函数样例"><a href="#规范函数样例" class="headerlink" title="规范函数样例"></a>规范函数样例</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">/*</span><br><span class="hljs-comment">函数名称：f_returngoodprice</span><br><span class="hljs-comment">函数参数说明：输入参数：good_id：字符串</span><br><span class="hljs-comment">函数返回值：该商品的销售单价：数值</span><br><span class="hljs-comment">创建人：</span><br><span class="hljs-comment">创建时间：</span><br><span class="hljs-comment">修改人：</span><br><span class="hljs-comment">修改时间：</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> replace <span class="hljs-keyword">function</span> f_returngoodprice(good_id varchar2)<br><span class="hljs-keyword">return</span> number <span class="hljs-keyword">as</span><br>v_goodprice t_goods.gprice<span class="hljs-operator">%</span>type;<span class="hljs-comment">--锚定变量类型</span><br><span class="hljs-keyword">begin</span><br>    <span class="hljs-keyword">select</span> nvl(gprice,<span class="hljs-number">0</span>)<span class="hljs-operator">*</span>nvl(gdiscount,<span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">into</span> v_goodprice<br>        <span class="hljs-keyword">from</span> t_goods<br>            <span class="hljs-keyword">where</span> <span class="hljs-built_in">upper</span>(<span class="hljs-built_in">trim</span>(gid))<span class="hljs-operator">=</span><span class="hljs-built_in">upper</span>(<span class="hljs-built_in">trim</span>(good_id));<br>    <span class="hljs-keyword">return</span> v_goodprice;<br><span class="hljs-keyword">end</span> f_returngoodprice;<br><span class="hljs-operator">/</span><br><span class="hljs-keyword">show</span> error;<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">/*</span><br><span class="hljs-comment">函数名称：f_returngmaxstocks</span><br><span class="hljs-comment">函数参数说明：输入参数：good_id：字符串</span><br><span class="hljs-comment">函数返回值：该商品的最大库存：数值</span><br><span class="hljs-comment">创建人：</span><br><span class="hljs-comment">创建时间：</span><br><span class="hljs-comment">修改人：</span><br><span class="hljs-comment">修改时间：</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> replace <span class="hljs-keyword">function</span> f_returngmaxstocks(good_id varchar2)<br><span class="hljs-keyword">return</span> number <span class="hljs-keyword">as</span><br>v_gmaxstocks t_goods.gmaxstocks<span class="hljs-operator">%</span>type;<br><span class="hljs-keyword">begin</span><br>    <span class="hljs-keyword">select</span> nvl(gmaxstocks,<span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">into</span> v_gmaxstocks<br>        <span class="hljs-keyword">from</span> t_goods<br>            <span class="hljs-keyword">where</span> <span class="hljs-built_in">upper</span>(<span class="hljs-built_in">trim</span>(gid))<span class="hljs-operator">=</span><span class="hljs-built_in">upper</span>(<span class="hljs-built_in">trim</span>(good_id));<br>    <span class="hljs-keyword">return</span> v_gmaxstocks;<br><span class="hljs-keyword">end</span> f_returngmaxstocks;<br><span class="hljs-operator">/</span><br><span class="hljs-keyword">show</span> error;<br></code></pre></td></tr></table></figure>

<h4 id="自动主键编码"><a href="#自动主键编码" class="headerlink" title="自动主键编码"></a>自动主键编码</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> sequence seq_uiid;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">函数名称：f_createuiid</span><br><span class="hljs-comment">函数参数说明：输入参数：</span><br><span class="hljs-comment">函数返回值：使用序列生产的uiid主键</span><br><span class="hljs-comment">创建人：</span><br><span class="hljs-comment">创建时间：</span><br><span class="hljs-comment">修改人：</span><br><span class="hljs-comment">修改时间：</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> replace <span class="hljs-keyword">function</span> f_createuiid <span class="hljs-keyword">return</span> varcahr2<br><span class="hljs-keyword">as</span><br>v_uiid varchar2(<span class="hljs-number">6</span>);<br>v_seq number;<br><span class="hljs-keyword">begin</span><br>    <span class="hljs-keyword">select</span> seq_uiid.nextval <span class="hljs-keyword">into</span> v_uiid <span class="hljs-keyword">from</span> dual;<br>    v_uiid:<span class="hljs-operator">=</span><span class="hljs-built_in">trim</span>(to_char(v_seq,<span class="hljs-string">&#x27;000000&#x27;</span>));<br>    <span class="hljs-keyword">return</span> v_uiid;<br><span class="hljs-keyword">end</span> f_createuiid;<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">/*</span><br><span class="hljs-comment">函数名称：f_createpmid</span><br><span class="hljs-comment">函数参数说明：输入参数：</span><br><span class="hljs-comment">函数返回值：使用序列生产的pmid主键</span><br><span class="hljs-comment">创建人：</span><br><span class="hljs-comment">创建时间：</span><br><span class="hljs-comment">修改人：</span><br><span class="hljs-comment">修改时间：</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> replace <span class="hljs-keyword">function</span> f_createpmid <span class="hljs-keyword">return</span> varchar2<br><span class="hljs-keyword">as</span><br>v_pmid varchar2(<span class="hljs-number">12</span>);<br>v_pmidin t_main_procure.pmid<span class="hljs-operator">%</span>type;<br><span class="hljs-keyword">begin</span><br>    v_pmid:<span class="hljs-operator">=</span><span class="hljs-string">&#x27;P&#x27;</span><span class="hljs-operator">||</span>to_char(sysdate,<span class="hljs-string">&#x27;yyyymm&#x27;</span>);<br>    <span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(pmid)<br>        <span class="hljs-keyword">into</span> v_pmidin<br>        <span class="hljs-keyword">from</span> t_main_procure<br>            <span class="hljs-keyword">where</span> to_char(sysdate,<span class="hljs-string">&#x27;yyyymm&#x27;</span>)<span class="hljs-operator">=</span>to_char(pdate,<span class="hljs-string">&#x27;yyyymm&#x27;</span>);<br>    if v_pmidin <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">then</span><br>        v_pmid:<span class="hljs-operator">=</span>v_pmid<span class="hljs-operator">||</span><span class="hljs-string">&#x27;00001&#x27;</span>;<br>    <span class="hljs-keyword">else</span><br>        v_pmid:<span class="hljs-operator">=</span>v_pmid<span class="hljs-operator">||</span><span class="hljs-built_in">trim</span>(to_char(to_number(substr(v_pmidin,<span class="hljs-number">8</span>,<span class="hljs-number">5</span>))<span class="hljs-operator">+</span><span class="hljs-number">1</span>,<span class="hljs-string">&#x27;00000&#x27;</span>));<br>    <span class="hljs-keyword">end</span> if;<br>    <span class="hljs-keyword">return</span> v_pmid;<br><span class="hljs-keyword">end</span> f_createpmid;<br><span class="hljs-operator">/</span><br><span class="hljs-keyword">show</span> error;<br><br><span class="hljs-keyword">select</span> f_createpmid() <span class="hljs-keyword">from</span> dual;<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">/*</span><br><span class="hljs-comment">函数名称：f_returnisenoughgoods</span><br><span class="hljs-comment">函数参数说明：输入参数：good_id：字符串，num销售数量</span><br><span class="hljs-comment">函数返回值：该商品的剩余库存是否够卖：数值</span><br><span class="hljs-comment">创建人：</span><br><span class="hljs-comment">创建时间：</span><br><span class="hljs-comment">修改人：</span><br><span class="hljs-comment">修改时间：</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> replace <span class="hljs-keyword">function</span> f_returnisenoughgoods(good_id varchar2, num number)<br><span class="hljs-keyword">return</span> number <span class="hljs-keyword">as</span><br>v_gstocks t_goods.gstocks<span class="hljs-operator">%</span>type;<br>enough number(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>):<span class="hljs-operator">=</span><span class="hljs-number">-1</span>;<br><span class="hljs-keyword">begin</span><br>    <span class="hljs-keyword">select</span> nvl(gstocks,<span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">into</span> v_gstocks<br>        <span class="hljs-keyword">from</span> t_goods<br>            <span class="hljs-keyword">where</span> <span class="hljs-built_in">upper</span>(<span class="hljs-built_in">trim</span>(gid))<span class="hljs-operator">=</span><span class="hljs-built_in">upper</span>(<span class="hljs-built_in">trim</span>(good_id));<br>    if v_gstocks<span class="hljs-operator">-</span>num<span class="hljs-operator">&gt;</span><span class="hljs-number">0</span> <span class="hljs-keyword">then</span><br>        enough:<span class="hljs-operator">=</span><span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">end</span> if;<br>    <span class="hljs-keyword">return</span> enough;<br>exception<br>    <span class="hljs-keyword">when</span> others <span class="hljs-keyword">then</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-2</span>;<br><span class="hljs-keyword">end</span> f_returnisenoughgoods;<br><span class="hljs-operator">/</span><br><span class="hljs-keyword">show</span> error;<br><span class="hljs-keyword">select</span> f_returnisenoughgoods(<span class="hljs-string">&#x27;g0005&#x27;</span>,<span class="hljs-number">15</span>) <span class="hljs-keyword">from</span> dual;<br></code></pre></td></tr></table></figure>

<h4 id="操作函数"><a href="#操作函数" class="headerlink" title="操作函数"></a>操作函数</h4><p>显示用户有的对象：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> object_name,object_type<br><span class="hljs-keyword">from</span> user_objects;<br></code></pre></td></tr></table></figure>

<p>查看函数代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">desc</span> user_source<br><br><span class="hljs-keyword">select</span> text<br><span class="hljs-keyword">from</span> user_source<br><span class="hljs-keyword">where</span> name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;F_RETURNISENOUGHGOODS&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>删除函数：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">function</span> F_RETURNISENOUGHGOODS;<br></code></pre></td></tr></table></figure>

<h3 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h3><p>存储过程样例：</p>
<ul>
<li>隐式游标：</li>
<li>cursor的名称是：SQL：每执行一条SQL语句以后自动创建的私有内存空间</li>
<li>SQL%found:布尔值，true:语句执行成功,false:失败</li>
<li>SQL%rowcount:integer,insert,update,delete,select影响的行数</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 增加一张采购单</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">存储过程名称：p_insertmainprocure</span><br><span class="hljs-comment">输入参数：i_sid:供应商编号:i_memo:备注:default:test</span><br><span class="hljs-comment">输出参数:o_result:1:添加成功,-1:发生错误,0:添加失败,-2:供应商不存在</span><br><span class="hljs-comment">创建人：</span><br><span class="hljs-comment">创建时间：</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> replace <span class="hljs-keyword">procedure</span> p_insertmainprocure(i_sid <span class="hljs-keyword">in</span> t_main_procure.sid<span class="hljs-operator">%</span>type, i_memo <span class="hljs-keyword">in</span> t_main_procure.pmemo<span class="hljs-operator">%</span>type <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;test&#x27;</span>, o_result <span class="hljs-keyword">out</span> number)<br><span class="hljs-keyword">as</span><br>v_count number:<span class="hljs-operator">=</span><span class="hljs-number">0</span>;<br><span class="hljs-keyword">begin</span><br>    <span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(sid)<br>        <span class="hljs-keyword">into</span> v_count<br>        <span class="hljs-keyword">from</span> t_supplier<br>            <span class="hljs-keyword">where</span> <span class="hljs-built_in">lower</span>(<span class="hljs-built_in">trim</span>(sid))<span class="hljs-operator">=</span><span class="hljs-built_in">lower</span>(<span class="hljs-built_in">trim</span>(i_sid));<br>    if v_count<span class="hljs-operator">=</span><span class="hljs-number">0</span> <span class="hljs-keyword">then</span><br>        o_result:<span class="hljs-operator">=</span><span class="hljs-number">-2</span>;<br>        <span class="hljs-keyword">return</span> o_result;<br>    <span class="hljs-keyword">end</span> if;<br><br>    <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_main_procure<br>        <span class="hljs-keyword">values</span>(f_createpmid(), i_sid, sysdate, <span class="hljs-keyword">null</span>, <span class="hljs-string">&#x27;1&#x27;</span>, i_memo);<br>    <span class="hljs-comment">--这里的SQL为隐式游标，%用来提取属性(影响了多少行)</span><br>    if <span class="hljs-keyword">SQL</span><span class="hljs-operator">%</span>rowcount<span class="hljs-operator">&gt;</span><span class="hljs-number">0</span> <span class="hljs-keyword">then</span><br>        o_result:<span class="hljs-operator">=</span><span class="hljs-number">1</span>;<span class="hljs-comment">--添加数据成功</span><br>    <span class="hljs-keyword">else</span><br>        o_result:<span class="hljs-operator">=</span><span class="hljs-number">0</span>;<span class="hljs-comment">--添加数据失败</span><br>    <span class="hljs-keyword">end</span> if;<br>    <span class="hljs-keyword">commit</span>;<br>exception<br>    <span class="hljs-keyword">when</span> others <span class="hljs-keyword">then</span><br>        o_result:<span class="hljs-operator">=</span>sqlcode;<br><span class="hljs-keyword">end</span> p_insertmainprocure;<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 没有输出参数的存储过程可以这样调用</span><br><span class="hljs-keyword">exec</span> p_insertmainprocure();<br><br><span class="hljs-comment">-- 有输出参数的存储过程，只能在程序中调用</span><br><span class="hljs-keyword">declare</span><br>v_result number;<br><span class="hljs-keyword">begin</span><br>    p_insertmainprocure(<span class="hljs-string">&#x27;p002&#x27;</span>,<span class="hljs-string">&#x27;通过存储过程添加&#x27;</span>,v_result);<br>    if v_result<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">then</span><br>        dbms_output.put_line(<span class="hljs-string">&#x27;添加成功&#x27;</span>);<br>    elsif v_result<span class="hljs-operator">=</span><span class="hljs-number">-2</span> <span class="hljs-keyword">then</span><br>        dbms_output.put_line(<span class="hljs-string">&#x27;添加失败&#x27;</span>);<br>    <span class="hljs-keyword">else</span><br>        dbms_output.put_line(<span class="hljs-string">&#x27;error&#x27;</span>);<br>    <span class="hljs-keyword">end</span> if;<br><span class="hljs-keyword">end</span>;<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 4)设计一个函数，实现订单编号的自动编码：&#x27;Oyyyymm00XXX&#x27;（练习）</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> replace <span class="hljs-keyword">function</span> f_createomid<br><span class="hljs-keyword">return</span> varchar2<br><span class="hljs-keyword">as</span><br>    v_omid varchar2(<span class="hljs-number">12</span>);<br>    v_maxomid t_main_order.omid<span class="hljs-operator">%</span>type;<br><span class="hljs-keyword">begin</span><br>    v_omid:<span class="hljs-operator">=</span><span class="hljs-string">&#x27;O&#x27;</span><span class="hljs-operator">||</span>to_char(sysdate,<span class="hljs-string">&#x27;yyyymm&#x27;</span>);<br>    <span class="hljs-comment">---去订单查询当月最大的那张单</span><br>    <span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(omid) <span class="hljs-keyword">into</span> v_maxomid<br>        <span class="hljs-keyword">from</span> t_main_order <span class="hljs-keyword">where</span> to_char(odate,<span class="hljs-string">&#x27;yyyymm&#x27;</span>)<span class="hljs-operator">=</span>to_char(sysdate,<span class="hljs-string">&#x27;yyyymm&#x27;</span>);<br>    if v_maxomid <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">then</span><br>        v_omid:<span class="hljs-operator">=</span>v_omid<span class="hljs-operator">||</span><span class="hljs-string">&#x27;00001&#x27;</span>;<span class="hljs-comment">--当月第一张单</span><br>    <span class="hljs-keyword">else</span><br>        v_omid:<span class="hljs-operator">=</span>v_omid<span class="hljs-operator">||</span><span class="hljs-built_in">trim</span>(to_char(to_number(substr(v_maxomid,<span class="hljs-number">8</span>,<span class="hljs-number">5</span>))<span class="hljs-operator">+</span><span class="hljs-number">1</span>,<span class="hljs-string">&#x27;00000&#x27;</span>));<br>    <span class="hljs-keyword">end</span> if;<span class="hljs-comment">-- --当月下一张单</span><br>    <span class="hljs-keyword">return</span> v_omid;<br>exception<br>    <span class="hljs-keyword">when</span> others <span class="hljs-keyword">then</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br><span class="hljs-keyword">end</span>;<br><span class="hljs-operator">/</span><br><span class="hljs-keyword">show</span> error;<br><br><span class="hljs-keyword">select</span> f_createomid <span class="hljs-keyword">from</span> dual;<br><br>添加订单明细数据:<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">  存储过程名称:p_insertorderitems</span><br><span class="hljs-comment">  输入参数:i_omid:订单编号;i_gid :商品编号；i_onum：数量,默认值为1</span><br><span class="hljs-comment">  输出参数:o_result:1:添加成功,-1:发生错误，0：添加不成功,-2:输入数据不准确</span><br><span class="hljs-comment">  创建人:miss lee</span><br><span class="hljs-comment">  创建日期:</span><br><span class="hljs-comment">  修改:</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> replace <span class="hljs-keyword">procedure</span> p_insertorderitems(i_omid <span class="hljs-keyword">in</span> t_order_items.omid<span class="hljs-operator">%</span>type, i_gid <span class="hljs-keyword">in</span> t_order_items.gid<span class="hljs-operator">%</span>type,  i_onum <span class="hljs-keyword">in</span> number <span class="hljs-keyword">default</span> <span class="hljs-number">1</span>,o_result <span class="hljs-keyword">out</span> number)<br><span class="hljs-keyword">as</span><br>v_count number:<span class="hljs-operator">=</span><span class="hljs-number">0</span>;<br><span class="hljs-keyword">begin</span><br>    <span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(omid) <span class="hljs-keyword">into</span> v_count      <span class="hljs-comment">--检查订单编号是否正确</span><br>        <span class="hljs-keyword">from</span> t_main_order <span class="hljs-keyword">where</span> <span class="hljs-built_in">trim</span>(omid)<span class="hljs-operator">=</span><span class="hljs-built_in">trim</span>(i_omid);<br>    if v_count<span class="hljs-operator">&lt;</span><span class="hljs-number">1</span> <span class="hljs-keyword">then</span><br>        o_result:<span class="hljs-operator">=</span><span class="hljs-number">-2</span>;<br>        <span class="hljs-keyword">return</span>;  <span class="hljs-comment">--退出程序</span><br>    <span class="hljs-keyword">end</span> if;<br>    <span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(gid) <span class="hljs-keyword">into</span> v_count    <span class="hljs-comment">--检查商品编号是否正确</span><br>        <span class="hljs-keyword">from</span> t_goods <span class="hljs-keyword">where</span> <span class="hljs-built_in">trim</span>(gid)<span class="hljs-operator">=</span><span class="hljs-built_in">trim</span>(i_gid);<br>    if v_count<span class="hljs-operator">&lt;</span><span class="hljs-number">1</span> <span class="hljs-keyword">then</span><br>        o_result:<span class="hljs-operator">=</span><span class="hljs-number">-2</span>;<br>        <span class="hljs-keyword">return</span>;  <span class="hljs-comment">--退出程序</span><br>    <span class="hljs-keyword">end</span> if;<br>    <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_order_items<br>        <span class="hljs-keyword">values</span>(i_omid,i_gid,f_returngoodprice(i_gid),i_onum,<span class="hljs-keyword">null</span>);<br>    o_result:<span class="hljs-operator">=</span><span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">commit</span>;<br>exception<br>    <span class="hljs-keyword">when</span> others <span class="hljs-keyword">then</span><br>        o_result:<span class="hljs-operator">=</span>sqlcode;<br>        <span class="hljs-keyword">rollback</span>;<br> <span class="hljs-keyword">end</span>;<br><span class="hljs-operator">/</span><br><span class="hljs-keyword">show</span> error;<br><br><span class="hljs-keyword">declare</span><br>v_result number;<br><span class="hljs-keyword">begin</span><br>    p_insertorderitems(<span class="hljs-string">&#x27;O20170800001&#x27;</span>,<span class="hljs-string">&#x27;g0006&#x27;</span>,<span class="hljs-number">10</span>,o_result<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span>v_result);<br>    if v_result<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">then</span><br>        dbms_output.put_line(<span class="hljs-string">&#x27;添加成功&#x27;</span>);<br>   elsif  v_result<span class="hljs-operator">=</span><span class="hljs-number">-2</span> <span class="hljs-keyword">then</span><br>        dbms_output.put_line(<span class="hljs-string">&#x27;数据不存在&#x27;</span>);<br>   <span class="hljs-keyword">else</span><br>        dbms_output.put_line(v_result);<br>   <span class="hljs-keyword">end</span> if;<br><span class="hljs-keyword">end</span>;<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> replace <span class="hljs-keyword">function</span> f_returngoodprice(good_id varchar2)<br>   <span class="hljs-keyword">return</span> number <span class="hljs-keyword">as</span><br>v_goodprice t_goods.gprice<span class="hljs-operator">%</span>type;<span class="hljs-comment">--锚定变量</span><br><span class="hljs-keyword">begin</span><br>    <span class="hljs-keyword">select</span> nvl(gprice,<span class="hljs-number">0</span>)<span class="hljs-operator">*</span>nvl(gdiscount,<span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">into</span> v_goodprice<br>        <span class="hljs-keyword">from</span> t_goods<br>            <span class="hljs-keyword">where</span> <span class="hljs-built_in">upper</span>(<span class="hljs-built_in">trim</span>(gid))<span class="hljs-operator">=</span><span class="hljs-built_in">upper</span>(good_id); <span class="hljs-comment">---</span><br>    <span class="hljs-keyword">return</span> v_goodprice;<br>exception<br>    <span class="hljs-keyword">when</span> others <span class="hljs-keyword">then</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<span class="hljs-comment">--自定义一个错误返回值</span><br><span class="hljs-keyword">end</span> f_returngoodprice;<br><br></code></pre></td></tr></table></figure>

<h4 id="操作返回结果为多条数据-列表-的情况"><a href="#操作返回结果为多条数据-列表-的情况" class="headerlink" title="操作返回结果为多条数据(列表)的情况"></a>操作返回结果为多条数据(列表)的情况</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> replace <span class="hljs-keyword">procedure</span> p_printemp(i_deptid number)<br><span class="hljs-keyword">as</span><br>v_name employees.first_name<span class="hljs-operator">%</span>type;<br>v_sal employees.salary<span class="hljs-operator">%</span>type;<br>v_hdate employees.hire_date<span class="hljs-operator">%</span>type;<br><span class="hljs-comment">-- 1.定义游标</span><br><span class="hljs-keyword">cursor</span> cur_emp <span class="hljs-keyword">is</span><br>    <span class="hljs-keyword">select</span> first_name,salary,hire_date            <br>        <span class="hljs-keyword">from</span> employees<br>            <span class="hljs-keyword">where</span> department_id<span class="hljs-operator">=</span>i_deptid;<br><span class="hljs-keyword">begin</span><br>    <span class="hljs-comment">-- 2.打开游标</span><br>    <span class="hljs-keyword">open</span> cur_emp;<br>    <span class="hljs-comment">-- 3.提取数据</span><br>    <span class="hljs-keyword">fetch</span> cur_emp <span class="hljs-keyword">into</span> v_name,v_sal,v_hdate;<br>    if cur_emp<span class="hljs-operator">%</span>notfound <span class="hljs-keyword">then</span><br>        dbms_output.put_line(<span class="hljs-string">&#x27;您输入的编号不存在&#x27;</span>);<br>    <span class="hljs-keyword">end</span> if;<br>    <span class="hljs-comment">-- 循环提取</span><br>    while(cur_emp<span class="hljs-operator">%</span>found) loop<br>        dbms_output.put_line(v_name<span class="hljs-operator">||</span><span class="hljs-string">&#x27;.&#x27;</span><span class="hljs-operator">||</span>v_sal<span class="hljs-operator">||</span><span class="hljs-string">&#x27;.&#x27;</span><span class="hljs-operator">||</span>v_hdate);<br>        <span class="hljs-keyword">fetch</span> cur_emp <span class="hljs-keyword">into</span> v_name,v_sal,v_hdate;<br>    <span class="hljs-keyword">end</span> loop;<br><br>    <span class="hljs-comment">--4.关闭游标</span><br>    <span class="hljs-keyword">close</span> cur_emp;<br><br>exception<br>    <span class="hljs-keyword">when</span> others <span class="hljs-keyword">then</span><br>        dbms_output.put_line(sqlerrm);<br><span class="hljs-keyword">end</span> p_printemp;<br></code></pre></td></tr></table></figure>

<h4 id="操作返回结果为多条数据-列表-的情况返回任意想要的属性值"><a href="#操作返回结果为多条数据-列表-的情况返回任意想要的属性值" class="headerlink" title="操作返回结果为多条数据(列表)的情况返回任意想要的属性值"></a>操作返回结果为多条数据(列表)的情况返回任意想要的属性值</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> replace <span class="hljs-keyword">procedure</span> p_printemp2(i_deptid number)<br><span class="hljs-keyword">as</span><br><span class="hljs-comment">-- 1.定义游标</span><br><span class="hljs-keyword">cursor</span> cur_emp <span class="hljs-keyword">is</span><br>    <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span><br>        <span class="hljs-keyword">from</span> employees<br>            <span class="hljs-keyword">where</span> department_id<span class="hljs-operator">=</span>i_deptid;<br><span class="hljs-comment">-- 游标的行记录类型</span><br>rec_emp cur_emp<span class="hljs-operator">%</span>rowtype;<br><span class="hljs-keyword">begin</span><br>    <span class="hljs-comment">-- 2.打开游标</span><br>    <span class="hljs-keyword">open</span> cur_emp;<br>    <span class="hljs-comment">-- 3.提取数据</span><br>    <span class="hljs-keyword">fetch</span> cur_emp <span class="hljs-keyword">into</span> rec_emp;<br>    if cur_emp<span class="hljs-operator">%</span>notfound <span class="hljs-keyword">then</span><br>        dbms_output.put_line(<span class="hljs-string">&#x27;您输入的编号不存在&#x27;</span>);<br>    <span class="hljs-keyword">end</span> if;<br>    <span class="hljs-comment">-- 循环提取</span><br>    while(cur_emp<span class="hljs-operator">%</span>found) loop<br>        dbms_output.put_line(rec_emp.last_name<span class="hljs-operator">||</span><span class="hljs-string">&#x27;.&#x27;</span><span class="hljs-operator">||</span>rec_emp.salary);<br>        <span class="hljs-keyword">fetch</span> cur_emp <span class="hljs-keyword">into</span> rec_emp;<br>    <span class="hljs-keyword">end</span> loop;<br><br>    <span class="hljs-comment">--4.关闭游标</span><br>    <span class="hljs-keyword">close</span> cur_emp;<br><br>exception<br>    <span class="hljs-keyword">when</span> others <span class="hljs-keyword">then</span><br>        dbms_output.put_line(sqlerrm);<br><span class="hljs-keyword">end</span> p_printemp2;<br><span class="hljs-operator">/</span><br><span class="hljs-keyword">show</span> error;<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">for</span> v_i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span>.<span class="hljs-number">.1000</span> loop<br><br><span class="hljs-keyword">end</span> loop;<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> replace <span class="hljs-keyword">procedure</span> p_printdeptandemp<br><span class="hljs-keyword">as</span><br><span class="hljs-comment">-- 1.定义游标</span><br><span class="hljs-keyword">cursor</span> cur_dept <span class="hljs-keyword">is</span><br>    <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span><br>        <span class="hljs-keyword">from</span> departments;<br><span class="hljs-keyword">cursor</span> cur_emp(deptno number) <span class="hljs-keyword">is</span><br>    <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span><br>        <span class="hljs-keyword">from</span> employees<br>            <span class="hljs-keyword">where</span> department_id<span class="hljs-operator">=</span>deptno;<br><span class="hljs-comment">-- 游标的行记录类型</span><br>rec_dept cur_dept<span class="hljs-operator">%</span>rowtype;<br>rec_emp cur_emp<span class="hljs-operator">%</span>rowtype;<br><span class="hljs-keyword">begin</span><br>    <span class="hljs-keyword">open</span> cur_dept;<br>    <span class="hljs-keyword">fetch</span> cur_dept <span class="hljs-keyword">into</span> rec_dept;<br>    while(cur_dept<span class="hljs-operator">%</span>found) loop<br>        dbms_output.put_line(<span class="hljs-string">&#x27;部门:&#x27;</span><span class="hljs-operator">||</span><span class="hljs-string">&#x27;.&#x27;</span><span class="hljs-operator">||</span>rec_dept.department_id<span class="hljs-operator">||</span><span class="hljs-string">&#x27;.&#x27;</span><span class="hljs-operator">||</span>rec_dept.department_name<span class="hljs-operator">||</span><span class="hljs-string">&#x27;.&#x27;</span><span class="hljs-operator">||</span>rec_dept.location_id);<br><br>        <span class="hljs-keyword">for</span> rec_emp <span class="hljs-keyword">in</span> cur_emp(rec_dept.department_id) loop<br>            dbms_output.put_line(<span class="hljs-string">&#x27;    员工:&#x27;</span><span class="hljs-operator">||</span><span class="hljs-string">&#x27;.&#x27;</span><span class="hljs-operator">||</span>rec_emp.employee_id<span class="hljs-operator">||</span><span class="hljs-string">&#x27;.&#x27;</span><span class="hljs-operator">||</span>rec_emp.first_name<span class="hljs-operator">||</span><span class="hljs-string">&#x27;.&#x27;</span><span class="hljs-operator">||</span>rec_emp.salary);<br>        <span class="hljs-keyword">end</span> loop;<br><br>        <span class="hljs-keyword">fetch</span> cur_dept <span class="hljs-keyword">into</span> rec_dept;<br>    <span class="hljs-keyword">end</span> loop;<br><br>    <span class="hljs-comment">--4.关闭游标</span><br>    <span class="hljs-keyword">close</span> cur_dept;<br><span class="hljs-keyword">end</span> p_printdeptandemp;<br><span class="hljs-operator">/</span><br><span class="hljs-keyword">show</span> error;<br></code></pre></td></tr></table></figure>

<h4 id="定义异常"><a href="#定义异常" class="headerlink" title="定义异常"></a>定义异常</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">declare</span><br>v_location number;<br>v_dept number;<br><span class="hljs-comment">-- 1.定义异常名</span><br>e_datanotnull exception;<br><span class="hljs-comment">-- 2.将已有的异常关联到异常名</span><br>pragma exception_init(e_datanotnull, <span class="hljs-number">-1400</span>);<br><br>e_depttohigh exception;<br><span class="hljs-keyword">begin</span><br>    v_location:<span class="hljs-operator">=</span><span class="hljs-operator">&amp;</span>部门编号<br>    v_dept:<span class="hljs-operator">=</span><span class="hljs-operator">&amp;</span>部门编号<br>    if v_dept<span class="hljs-operator">&gt;</span><span class="hljs-number">10000</span><br>        raise e_depttohigh;<br>    <span class="hljs-keyword">end</span> if;<br>    if v_location<span class="hljs-operator">&gt;</span><span class="hljs-number">10000</span><br>        <span class="hljs-comment">-- 给自定义异常编异常号码需在(-20000,-30000)区间内</span><br>        raise_application_error(<span class="hljs-number">-20001</span>,<span class="hljs-string">&#x27;地址编号太大&#x27;</span>);<br>    <span class="hljs-keyword">end</span> if;<br><br>exception<br>    <span class="hljs-keyword">when</span> e_depttohigh <span class="hljs-keyword">then</span><br>        dbms_output.put_line(<span class="hljs-string">&#x27;v_dept&gt;10000&#x27;</span>);<br>    <span class="hljs-keyword">when</span> others <span class="hljs-keyword">then</span><br>        dbms_output.put_line(sqlerrm);<br><span class="hljs-keyword">end</span>;<br></code></pre></td></tr></table></figure>


<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">/*</span><br><span class="hljs-comment">  存储过程名称:p_checkorder</span><br><span class="hljs-comment">  功能描述：</span><br><span class="hljs-comment">  0.检查该单据是否已经审核，若审核则抛出自定义异常</span><br><span class="hljs-comment">  1.计算采购单的总金额</span><br><span class="hljs-comment">  2.更新采购明细的商品的库存、单价(加权平均法)</span><br><span class="hljs-comment">  3.更新采购单的状态为已审核</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">  输入参数:i_pmid采购单编号;</span><br><span class="hljs-comment">  输出参数:o_result:1:审核成功,0：发生未知错误</span><br><span class="hljs-comment">  异常：-20001:该单据状态不是待审核;-20002:有商品超出最高库存(裁剪);-20003:该单据不存在;-2004:该单据没有明细</span><br><span class="hljs-comment">  创建人:</span><br><span class="hljs-comment">  创建日期:</span><br><span class="hljs-comment">  修改:</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> replace <span class="hljs-keyword">procedure</span> p_checkorder(i_pmid T_MAIN_PROCURE.pmid<span class="hljs-operator">%</span>type, o_result <span class="hljs-keyword">out</span> number)<br><span class="hljs-keyword">as</span><br>v_count number:<span class="hljs-operator">=</span><span class="hljs-number">0</span>;<br>v_pstate T_MAIN_PROCURE.pstate<span class="hljs-operator">%</span>type;<br>v_pamount T_MAIN_PROCURE.pamount<span class="hljs-operator">%</span>type;<br>v_gstocks T_GOODS.gstocks<span class="hljs-operator">%</span>type;<br>v_gminstocks T_GOODS.gminstocks<span class="hljs-operator">%</span>type;<br><span class="hljs-comment">-- 若已审核则抛出异常</span><br>e_alreadychecked exception;<br><span class="hljs-comment">-- 1.定义游标</span><br><span class="hljs-keyword">cursor</span> cur_items <span class="hljs-keyword">is</span><br>    <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span><br>        <span class="hljs-keyword">from</span> T_PROCURE_ITEMS<br>            <span class="hljs-keyword">where</span> <span class="hljs-built_in">lower</span>(<span class="hljs-built_in">trim</span>(pmid))<span class="hljs-operator">=</span><span class="hljs-built_in">lower</span>(<span class="hljs-built_in">trim</span>(i_pmid));<br><span class="hljs-comment">-- 游标的行记录类型</span><br>rec_items cur_items<span class="hljs-operator">%</span>rowtype;<br><span class="hljs-keyword">begin</span><br>    v_pamount:<span class="hljs-operator">=</span><span class="hljs-number">0</span>;<br><br><span class="hljs-comment">-- 判断采购单存不存在</span><br>    <span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(pmid)<br>        <span class="hljs-keyword">into</span> v_count<br>        <span class="hljs-keyword">from</span> T_MAIN_PROCURE<br>            <span class="hljs-keyword">where</span> <span class="hljs-built_in">lower</span>(<span class="hljs-built_in">trim</span>(pmid))<span class="hljs-operator">=</span><span class="hljs-built_in">lower</span>(<span class="hljs-built_in">trim</span>(i_pmid));<br>    if v_count<span class="hljs-operator">=</span><span class="hljs-number">0</span> <span class="hljs-keyword">then</span><br>        raise_application_error(<span class="hljs-number">-20003</span>,<span class="hljs-string">&#x27;该单据不存在&#x27;</span>);<br>    <span class="hljs-keyword">end</span> if;<br><br><span class="hljs-comment">-- 0.检查该单据是否已经审核，若审核则抛出自定义异常</span><br>    <span class="hljs-keyword">select</span> pstate<br>        <span class="hljs-keyword">into</span> v_pstate<br>        <span class="hljs-keyword">from</span> T_MAIN_PROCURE<br>        <span class="hljs-keyword">where</span> <span class="hljs-built_in">lower</span>(<span class="hljs-built_in">trim</span>(pmid))<span class="hljs-operator">=</span><span class="hljs-built_in">lower</span>(<span class="hljs-built_in">trim</span>(i_pmid));<br>    if v_pstate<span class="hljs-operator">&lt;&gt;</span><span class="hljs-number">1</span> <span class="hljs-keyword">then</span><br>        raise_application_error(<span class="hljs-number">-20001</span>,<span class="hljs-string">&#x27;该单据状态不是待审核&#x27;</span>);<br>    <span class="hljs-keyword">end</span> if;<br><br><span class="hljs-comment">--  1.计算采购单的总金额</span><br><span class="hljs-comment">--  2.更新采购明细的商品的库存、单价(加权平均法)</span><br>    <span class="hljs-keyword">open</span> cur_items;<br><br>    <span class="hljs-keyword">fetch</span> cur_items <span class="hljs-keyword">into</span> rec_items;<br>    if cur_items<span class="hljs-operator">%</span>notfound <span class="hljs-keyword">then</span><br>        raise_application_error(<span class="hljs-number">-20004</span>,<span class="hljs-string">&#x27;该单据没有明细&#x27;</span>);<br>    <span class="hljs-keyword">end</span> if;<br>    while(cur_items<span class="hljs-operator">%</span>found) loop<br>        <span class="hljs-keyword">update</span> t_goods<br>        <span class="hljs-keyword">set</span> gstocks<span class="hljs-operator">=</span>gstocks<span class="hljs-operator">+</span>rec_items.pinum, gprice<span class="hljs-operator">=</span>round((gstocks<span class="hljs-operator">*</span>gprice<span class="hljs-operator">+</span>rec_items.pinum<span class="hljs-operator">*</span>rec_items.piprice<br>        )<span class="hljs-operator">/</span>(gstocks<span class="hljs-operator">+</span>rec_items.pinum))<br>        <span class="hljs-keyword">where</span> gid<span class="hljs-operator">=</span>rec_items.gid;<br>        v_pamount:<span class="hljs-operator">=</span>v_pamount<span class="hljs-operator">+</span>rec_items.pimoney;<br>        <span class="hljs-keyword">fetch</span> cur_items <span class="hljs-keyword">into</span> rec_items;<br>    <span class="hljs-keyword">end</span> loop;<br><br>    <span class="hljs-keyword">close</span> cur_items;<br><br>    dbms_output.put_line(<span class="hljs-string">&#x27;采购单&#x27;</span><span class="hljs-operator">||</span>i_pmid<span class="hljs-operator">||</span><span class="hljs-string">&#x27;的总金额&#x27;</span><span class="hljs-operator">||</span>v_pamount);<br><br><span class="hljs-comment">-- 3.更新采购单的状态为已审核</span><br>    <span class="hljs-keyword">update</span> T_MAIN_PROCURE <span class="hljs-keyword">set</span> T_MAIN_PROCURE.pstate<span class="hljs-operator">=</span><span class="hljs-string">&#x27;2&#x27;</span>,T_MAIN_PROCURE.pamount<span class="hljs-operator">=</span>v_pamount<br>    <span class="hljs-keyword">where</span> <span class="hljs-built_in">lower</span>(<span class="hljs-built_in">trim</span>(pmid))<span class="hljs-operator">=</span><span class="hljs-built_in">lower</span>(<span class="hljs-built_in">trim</span>(i_pmid));<br>    <br>    o_result:<span class="hljs-operator">=</span><span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">commit</span>;<br><br>exception<br>    <span class="hljs-keyword">when</span> others <span class="hljs-keyword">then</span><br>        o_result:<span class="hljs-operator">=</span>sqlcode;<br>        <span class="hljs-keyword">rollback</span>;<br><span class="hljs-keyword">end</span> p_checkorder;<br><span class="hljs-operator">/</span><br><span class="hljs-keyword">show</span> error;<br></code></pre></td></tr></table></figure>

<h3 id="触发器-trigger"><a href="#触发器-trigger" class="headerlink" title="触发器 trigger"></a>触发器 <code>trigger</code></h3><h4 id="行级触发器样例"><a href="#行级触发器样例" class="headerlink" title="行级触发器样例"></a>行级触发器样例</h4><blockquote>
<p>:new 代表：</p>
<ul>
<li>insert操作中添加的行记录</li>
<li>update操作中更新以后的行记录</li>
</ul>
</blockquote>
<blockquote>
<p>:old 代表：</p>
<ul>
<li>delete操作中删除的行记录</li>
<li>update操作中更新以前的行记录</li>
</ul>
</blockquote>
<p>若在触发器中想要阻止某个操作只能通过抛出一个异常来中断</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> replace <span class="hljs-keyword">trigger</span> tr_checkpitemsinsert<br>before <span class="hljs-keyword">insert</span> <span class="hljs-keyword">on</span> t_procure_items<br><span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> <span class="hljs-type">row</span> <span class="hljs-comment">--  行级触发器</span><br><span class="hljs-keyword">declare</span><br>    v_state t_main_procure.pstate<span class="hljs-operator">%</span>type;<br><span class="hljs-keyword">begin</span><br>    <span class="hljs-comment">--  判断所添加的明细数据的单据是否是待审核</span><br>    <span class="hljs-comment">--  if not 待审核</span><br>    <span class="hljs-keyword">select</span> pstate<br>        <span class="hljs-keyword">into</span> v_state<br>        <span class="hljs-keyword">from</span> t_main_procure<br>            <span class="hljs-keyword">where</span> pmid<span class="hljs-operator">=</span>:new.pmid;<br>    if v_state<span class="hljs-operator">&lt;&gt;</span><span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-keyword">then</span><br>        raise_application_error(<span class="hljs-string">&#x27;-20001&#x27;</span>,<span class="hljs-string">&#x27;该单据已经审核不能再添加&#x27;</span>);<br>    <span class="hljs-keyword">end</span> if;<br><span class="hljs-keyword">end</span>;<br><span class="hljs-operator">/</span><br><span class="hljs-keyword">show</span> error;<br></code></pre></td></tr></table></figure>

<h4 id="触发器的分类"><a href="#触发器的分类" class="headerlink" title="触发器的分类"></a>触发器的分类</h4><ol>
<li>DML操作：insert,update,delete</li>
<li>视图的替代触发器</li>
<li>DDL操作:create,alter</li>
<li>数据库系统级别触发器</li>
</ol>
<h4 id="DML-触发器"><a href="#DML-触发器" class="headerlink" title="DML 触发器"></a>DML 触发器</h4><p>timing:</p>
<ul>
<li>before:执行操作之前进行处理</li>
<li>after:执行操作之后进行处理</li>
<li>instead of:在视图上进行操作时进行替代</li>
</ul>
<p>object_name:table or view的名字</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> replace <span class="hljs-keyword">trigger</span> trigger_name<br>timing r_body <span class="hljs-keyword">on</span> object_name<br><span class="hljs-keyword">declare</span><br>    <br><span class="hljs-keyword">begin</span><br><br><span class="hljs-keyword">end</span>;<br></code></pre></td></tr></table></figure>

<h4 id="合并触发器"><a href="#合并触发器" class="headerlink" title="合并触发器"></a>合并触发器</h4><p>如果多个触发器是同一个表上，进行同一个时间介词(before,after)，同一个触发次数类型(语句级的，行级)则可合并触发器</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> replace <span class="hljs-keyword">trigger</span> tr_checkpitems<br>before <span class="hljs-keyword">update</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">insert</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">delete</span> <span class="hljs-keyword">on</span> t_procure_items<br><span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> <span class="hljs-type">row</span> <span class="hljs-comment">--  行级触发器</span><br><span class="hljs-keyword">declare</span><br>    v_state t_main_procure.pstate<span class="hljs-operator">%</span>type;<br><span class="hljs-keyword">begin</span><br>    if inserting <span class="hljs-keyword">then</span><br>        <span class="hljs-keyword">select</span> pstate<br>            <span class="hljs-keyword">into</span> v_state<br>            <span class="hljs-keyword">from</span> t_main_procure<br>                <span class="hljs-keyword">where</span> pmid<span class="hljs-operator">=</span>:new.pmid;<br>    elsif updating <span class="hljs-keyword">or</span> deleting <span class="hljs-keyword">then</span><br>        <span class="hljs-keyword">select</span> pstate<br>            <span class="hljs-keyword">into</span> v_state<br>            <span class="hljs-keyword">from</span> t_main_procure<br>                <span class="hljs-keyword">where</span> pmid<span class="hljs-operator">=</span>:old.pmid;<br>    <span class="hljs-keyword">end</span> if;<br><br>    if v_state<span class="hljs-operator">&lt;&gt;</span><span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-keyword">then</span><br>        raise_application_error(<span class="hljs-string">&#x27;-20001&#x27;</span>,<span class="hljs-string">&#x27;该单据已经审核不能再删除</span><br><span class="hljs-string">&#x27;</span>);<br>    <span class="hljs-keyword">end</span> if;<br><span class="hljs-keyword">end</span>;<br><span class="hljs-operator">/</span><br><span class="hljs-keyword">show</span> error;<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> replace <span class="hljs-keyword">trigger</span> tr_updateprocuremainmoney<br>after <span class="hljs-keyword">update</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">delete</span> <span class="hljs-keyword">of</span> PPRICE,PNUM <span class="hljs-keyword">or</span> <span class="hljs-keyword">insert</span> <span class="hljs-keyword">on</span> t_procure_items<br><span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> <span class="hljs-type">row</span><br><span class="hljs-keyword">declare</span><br>    v_pamount t_main_procure.PAMOUNT<span class="hljs-operator">%</span>type;<br><span class="hljs-keyword">begin</span><br><br>    if inserting <span class="hljs-keyword">then</span><br>        <span class="hljs-keyword">update</span> t_main_procure <span class="hljs-keyword">set</span><br>            pamount<span class="hljs-operator">=</span>nvl(pamount,<span class="hljs-number">0</span>)<span class="hljs-operator">+</span>:new.pinum<span class="hljs-operator">*</span>:new.piprice;<br>                <span class="hljs-keyword">where</span> pmid<span class="hljs-operator">=</span>:new.pmid;<br><br>    elsif updating <span class="hljs-keyword">then</span><br>        <span class="hljs-keyword">update</span> t_main_procure <span class="hljs-keyword">set</span><br>            pamount<span class="hljs-operator">=</span>nvl(pamount,<span class="hljs-number">0</span>)<span class="hljs-operator">-</span>:old.pinum<span class="hljs-operator">*</span>:old.piprice<span class="hljs-operator">+</span>:new.pinum<span class="hljs-operator">*</span>:new.piprice;<br>                <span class="hljs-keyword">where</span> pmid<span class="hljs-operator">=</span>:new.pmid;<br><br>    elsif deleting <span class="hljs-keyword">then</span><br>        <span class="hljs-keyword">update</span> t_main_procure <span class="hljs-keyword">set</span><br>            pamount<span class="hljs-operator">=</span>nvl(pamount,<span class="hljs-number">0</span>)<span class="hljs-operator">-</span>:old.pinum<span class="hljs-operator">*</span>:old.piprice;<br>                <span class="hljs-keyword">where</span> pmid<span class="hljs-operator">=</span>:new.pmid;<br><br>    <span class="hljs-keyword">end</span> if;<br>   <br><span class="hljs-keyword">end</span>;<br><span class="hljs-operator">/</span><br><span class="hljs-keyword">show</span> error;<br></code></pre></td></tr></table></figure>

<h4 id="日志触发器样例"><a href="#日志触发器样例" class="headerlink" title="日志触发器样例"></a>日志触发器样例</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> <span class="hljs-built_in">log</span>(<br>lid number(<span class="hljs-number">9</span>,<span class="hljs-number">0</span>) <span class="hljs-keyword">primary</span> key,<br>employee_id number(<span class="hljs-number">6</span>,<span class="hljs-number">0</span>) <span class="hljs-keyword">references</span> employees(employee_id),<br>old_salary number(<span class="hljs-number">8</span>,<span class="hljs-number">2</span>),<br>new_salary number(<span class="hljs-number">8</span>,<span class="hljs-number">2</span>),<br>opdate <span class="hljs-type">Date</span>,<br>opuser varchar2(<span class="hljs-number">20</span>)<br>);<br><span class="hljs-keyword">create</span> sequence seq_lid<br><span class="hljs-keyword">start</span> <span class="hljs-keyword">with</span> <span class="hljs-number">1</span><br>increment <span class="hljs-keyword">by</span> <span class="hljs-number">1</span>;<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> replace <span class="hljs-keyword">trigger</span> tr_updatemployeesalary<br>after <span class="hljs-keyword">update</span> <span class="hljs-keyword">on</span> employees<br><span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> <span class="hljs-type">row</span><br><span class="hljs-keyword">declare</span><br>    <br><span class="hljs-keyword">begin</span><br>    <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> log <span class="hljs-keyword">values</span>(seq_lid.nextval, :new.employee_id, :old.salary, :new.salary, sysdate, <span class="hljs-keyword">user</span>);<br><span class="hljs-keyword">end</span>;<br><span class="hljs-operator">/</span><br><span class="hljs-keyword">show</span> error;<br><br><span class="hljs-keyword">update</span> employees <span class="hljs-keyword">set</span> salary<span class="hljs-operator">=</span><span class="hljs-number">20000</span><br><span class="hljs-keyword">where</span> employee_id<span class="hljs-operator">=</span><span class="hljs-number">100</span>;<br></code></pre></td></tr></table></figure>

<h4 id="登录触发器"><a href="#登录触发器" class="headerlink" title="登录触发器"></a>登录触发器</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 记录用户的登录信息</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> replace <span class="hljs-keyword">trigger</span> tr_logon<br>after logon <span class="hljs-keyword">on</span> database<br><span class="hljs-keyword">begin</span><br>    <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_mylog<br>    <span class="hljs-keyword">values</span>(seq_log.nextval,<span class="hljs-keyword">user</span>,<span class="hljs-keyword">default</span>,<span class="hljs-string">&#x27;logon&#x27;</span>,sys_context(<span class="hljs-string">&#x27;USERENV&#x27;</span>,<span class="hljs-string">&#x27;IP_ADDRESS&#x27;</span>));<br><span class="hljs-keyword">end</span>;<br><span class="hljs-comment">-- 记录用户的登出信息</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> replace <span class="hljs-keyword">trigger</span> tr_logoff<br>before logoff <span class="hljs-keyword">on</span> database<br><span class="hljs-keyword">begin</span><br>    <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_mylog<br>    <span class="hljs-keyword">values</span>(seq_log.nextval,<span class="hljs-keyword">user</span>,<span class="hljs-keyword">default</span>,<span class="hljs-string">&#x27;logoff&#x27;</span>,sys_context(<span class="hljs-string">&#x27;USERENV&#x27;</span>,<span class="hljs-string">&#x27;IP_ADDRESS&#x27;</span>));<br><span class="hljs-keyword">end</span>;<br></code></pre></td></tr></table></figure>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2017/07/30/Nodejs/Node.js%E4%B8%AD%E4%BD%BF%E7%94%A8Authenticator(%E4%B8%A4%E9%83%A8%E9%AA%8C%E8%AF%81%E5%99%A8)/">← Next Oracle PL</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2017/07/30/Database/Oracle/Oracle-SQL/">Oracle SQL Prev →</a></div></div></div><div id="comments"><div class="selector"><button class="gitalk-sel"></button></div><div id="gitalk"></div></div></div><div class="bottom-btn"><div><a id="to-top" onClick="scrolls.scrolltop();" title="回到顶部" style="opacity: 0; display: none;">∧</a><a id="to-index" href="#toc-div" title="文章目录">≡</a><a id="color-mode" onClick="colorMode.change()" title="切换主题"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">Sicmatr1x</a></h1><div id="description"><p>INTP/Traveller/Stoicism/Crypto-anarchism/Minimalism/Cosmopolitanism/English learner/Crypto/Java Engineer</p></div></div><div id="aside-block"><div id="toc-div"><h1>目录</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="toc-number">1.</span> <span class="toc-text">基础概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E5%86%99-PL-x2F-SQL"><span class="toc-number">2.</span> <span class="toc-text">编写 PL&#x2F;SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0"><span class="toc-number">2.1.</span> <span class="toc-text">函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E5%8F%82%E6%95%B0%E8%BF%94%E5%9B%9E%E5%80%BC%E5%87%BD%E6%95%B0%E6%A0%B7%E4%BE%8B"><span class="toc-number">2.1.1.</span> <span class="toc-text">无参数返回值函数样例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%89%E5%8F%82%E6%95%B0%E8%BF%94%E5%9B%9E%E5%80%BC%E5%87%BD%E6%95%B0%E6%A0%B7%E4%BE%8B"><span class="toc-number">2.1.2.</span> <span class="toc-text">有参数返回值函数样例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%84%E8%8C%83%E5%87%BD%E6%95%B0%E6%A0%B7%E4%BE%8B"><span class="toc-number">2.1.3.</span> <span class="toc-text">规范函数样例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E4%B8%BB%E9%94%AE%E7%BC%96%E7%A0%81"><span class="toc-number">2.1.4.</span> <span class="toc-text">自动主键编码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0"><span class="toc-number">2.1.5.</span> <span class="toc-text">操作函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">2.2.</span> <span class="toc-text">存储过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C%E4%B8%BA%E5%A4%9A%E6%9D%A1%E6%95%B0%E6%8D%AE-%E5%88%97%E8%A1%A8-%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-number">2.2.1.</span> <span class="toc-text">操作返回结果为多条数据(列表)的情况</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C%E4%B8%BA%E5%A4%9A%E6%9D%A1%E6%95%B0%E6%8D%AE-%E5%88%97%E8%A1%A8-%E7%9A%84%E6%83%85%E5%86%B5%E8%BF%94%E5%9B%9E%E4%BB%BB%E6%84%8F%E6%83%B3%E8%A6%81%E7%9A%84%E5%B1%9E%E6%80%A7%E5%80%BC"><span class="toc-number">2.2.2.</span> <span class="toc-text">操作返回结果为多条数据(列表)的情况返回任意想要的属性值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8"><span class="toc-number">2.2.3.</span> <span class="toc-text">定义异常</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8-trigger"><span class="toc-number">2.3.</span> <span class="toc-text">触发器 trigger</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%8C%E7%BA%A7%E8%A7%A6%E5%8F%91%E5%99%A8%E6%A0%B7%E4%BE%8B"><span class="toc-number">2.3.1.</span> <span class="toc-text">行级触发器样例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">2.3.2.</span> <span class="toc-text">触发器的分类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DML-%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">2.3.3.</span> <span class="toc-text">DML 触发器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%88%E5%B9%B6%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">2.3.4.</span> <span class="toc-text">合并触发器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E8%A7%A6%E5%8F%91%E5%99%A8%E6%A0%B7%E4%BE%8B"><span class="toc-number">2.3.5.</span> <span class="toc-text">日志触发器样例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">2.3.6.</span> <span class="toc-text">登录触发器</span></a></li></ol></li></ol></li></ol></div></div><footer><nobr>构建自 <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> 使用主题 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>主题作者 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script class="pjax-js">reset=_=>{gitalk = new Gitalk({
 clientID: '',
 clientSecret: '',
 repo: 'blog-comments',
 owner: 'Sicmatr1x',
 admin: ['Sicmatr1x'],
 distractionFreeMode: false,
 id: 
});
if (document.querySelector("#gitalk")) gitalk.render("gitalk");code.findCode();}</script><script src="/js/arknights.js"></script><script src="/js/pjax.js"></script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>