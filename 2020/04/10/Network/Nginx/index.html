<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Nginx | Sicmatr1x's Blog</title><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"键入以继续","blurHolder":"数据检索","noResult":"无 $0 相关数据"},"code":{"codeInfo":"$0 - 共 $1 行","copy":"复制","copyFinish":"复制成功","expand":"展开"}}</script><script src="/js/gitalk.js"></script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Sicmatr1x's Blog" type="application/atom+xml">
</head><body><div class="loading" style="opacity: 0"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn hide"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/toolkit/"><span class="navItemTitle">Toolkit</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>Nginx</h1><div id="post-info"><span>文章发布时间: <div class="control"><time datetime="2020-04-10T01:43:00.000Z" id="date"> 2020-04-10</time></div></span><br><span>最后更新时间: <div class="control"><time datetime="2023-03-26T08:12:23.632Z" id="updated"> 2023-03-26</time></div></span></div></div><hr><div id="post-content"><p>Nginx (engine x) 是一个高性能的HTTP和反向代理web服务器，同时也提供了IMAP&#x2F;POP3&#x2F;SMTP服务。Nginx是由伊戈尔·赛索耶夫为俄罗斯访问量第二的Rambler.ru站点（俄文：Рамблер）开发的。</p>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><h3 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h3><h4 id="正向代理"><a href="#正向代理" class="headerlink" title="正向代理"></a>正向代理</h4><p>在客户端(浏览器)中配置代理服务器，通过代理服务器进行互联网访问。</p>
<h4 id="反向代理-1"><a href="#反向代理-1" class="headerlink" title="反向代理"></a>反向代理</h4><h3 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h3><h3 id="动静分离"><a href="#动静分离" class="headerlink" title="动静分离"></a>动静分离</h3><h3 id="高可用"><a href="#高可用" class="headerlink" title="高可用"></a>高可用</h3><h2 id="install"><a href="#install" class="headerlink" title="install"></a>install</h2><p><a target="_blank" rel="noopener" href="http://nginx.org/en/download.html">http://nginx.org/en/download.html</a></p>
<h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><h4 id="pcre"><a href="#pcre" class="headerlink" title="pcre"></a>pcre</h4><p>解压pcre压缩包，进入目录执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">./configure<br><br>make &amp;&amp; make install<br></code></pre></td></tr></table></figure>

<p>查看版本号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">pcre-config --version<br></code></pre></td></tr></table></figure>

<h4 id="zlib与openssl"><a href="#zlib与openssl" class="headerlink" title="zlib与openssl"></a>zlib与openssl</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">yum -y install make zlib zlib-devel gcc-c++ libtool openssl openssl-devel<br></code></pre></td></tr></table></figure>

<h4 id="或者使用yum一键安装上述3个依赖"><a href="#或者使用yum一键安装上述3个依赖" class="headerlink" title="或者使用yum一键安装上述3个依赖"></a>或者使用<code>yum</code>一键安装上述3个依赖</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">yum -y install gcc zlib zlib-devel pcre-devel openssl openssl-devel<br></code></pre></td></tr></table></figure>

<h4 id="安装-nginx"><a href="#安装-nginx" class="headerlink" title="安装 nginx"></a>安装 nginx</h4><p>解压nginx压缩包，进入目录执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">./configure<br><br>make &amp;&amp; make install<br></code></pre></td></tr></table></figure>

<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">cd /usr/local/nginx<br></code></pre></td></tr></table></figure>

<p>nginx的启动脚本在<code>nginx/sbin</code>文件夹下面</p>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">cd /usr/local/nginx/sbin<br>./nginx<br><br>ps -ef | grep nginx<br></code></pre></td></tr></table></figure>

<h3 id="配置防火墙"><a href="#配置防火墙" class="headerlink" title="配置防火墙"></a>配置防火墙</h3><p>查看防火墙规则：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">firewall-cmd --list-all<br></code></pre></td></tr></table></figure>

<p>添加规则：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">firewall-cmd --add-service=http =permanent<br>sudo firewall-cmd --add-port=80/tcp --permanent<br></code></pre></td></tr></table></figure>

<p>重启防火墙：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">firewall-cmd -reload<br></code></pre></td></tr></table></figure>

<h2 id="nginx-常用命令"><a href="#nginx-常用命令" class="headerlink" title="nginx 常用命令"></a>nginx 常用命令</h2><p>进入nginx根目录或者将其添加到<code>PATH</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">cd /usr/local/nginx/sbin<br></code></pre></td></tr></table></figure>

<h4 id="查看nginx版本号"><a href="#查看nginx版本号" class="headerlink" title="查看nginx版本号"></a>查看nginx版本号</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">./nginx -v<br></code></pre></td></tr></table></figure>

<h4 id="启动nginx"><a href="#启动nginx" class="headerlink" title="启动nginx"></a>启动nginx</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">./nginx<br></code></pre></td></tr></table></figure>

<h4 id="关闭nginx"><a href="#关闭nginx" class="headerlink" title="关闭nginx"></a>关闭nginx</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">./nginx -s stop<br></code></pre></td></tr></table></figure>

<h4 id="重新加载nginx"><a href="#重新加载nginx" class="headerlink" title="重新加载nginx"></a>重新加载nginx</h4><p><code>nginx.conf</code>文件内容修改后需要重新加载才能生效，此命令可以使得在不重启nginx情况下应用修改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">./nginx -s reload<br></code></pre></td></tr></table></figure>

<h2 id="配置文件nginx-conf"><a href="#配置文件nginx-conf" class="headerlink" title="配置文件nginx.conf"></a>配置文件<code>nginx.conf</code></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">cd /usr/local/nginx/conf<br></code></pre></td></tr></table></figure>

<p>配置文件由3部分组成：</p>
<ol>
<li>全局块：从配置文件开始到events块之间的内容，主要会设置一些影响nginx服务器整体运行的配置指令</li>
<li>events块：主要影响nginx服务器与用户的网络连接，常用的设置包括是否开启对多worker processes下的网络连接进行序列化，是否允许同时接受多个网络连接，选取暗中事件驱动模型来处理连接请求，每个word process可以同时支持的最大连接数等</li>
<li>http块：包含http全局块和server块，代理、缓存和日志等绝大多数功能和第三方模块的配置都在这里<ul>
<li>http全局块：包括文件引入、MIME-TYPE协议、日志自定义、连接超时时间、单链接请求数上限等</li>
<li>server块：包含全局server块和location块，和虚拟主机有密切关系，虚拟主机从用户角度看和一台独立的硬件主机完全一样，该技术主要用于节省互联网服务器硬件成本<ul>
<li>全局server块：最常见的配置是虚拟主机的监听配置和本虚拟主机的名称或IP配置</li>
<li>location块：一个server块可以配置多个location块，这个块的主要作用是基于nginx服务器收到的请求字符串(例如：server_name&#x2F;uri-string)，对虚拟主机名称(或IP别名)之外的字符串(例如：&#x2F;uri-string)进行匹配，对特定的请求进行处理。地址定向、数据缓存和应答控制等功能，还有许多第三方模块的配置也在这里。</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="全局块"><a href="#全局块" class="headerlink" title="全局块"></a>全局块</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs conf">#user  nobody;<br>worker_processes  1; #nginx服务器并发处理关键配置，worker_processes值越大，可以支持的并发处理量越多，但是受硬件、软件等设备制约<br><br>#error_log  logs/error.log;<br>#error_log  logs/error.log  notice;<br>#error_log  logs/error.log  info;<br><br>#pid        logs/nginx.pid;<br></code></pre></td></tr></table></figure>

<h3 id="events块"><a href="#events块" class="headerlink" title="events块"></a>events块</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs conf">events &#123;<br>    worker_connections  1024; #表示每个worker processes支持的最大连接数为1024<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="http块"><a href="#http块" class="headerlink" title="http块"></a>http块</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs conf">http &#123;<br>    # http全局块<br>    include       mime.types;<br>    default_type  application/octet-stream;<br><br>    #log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;<br>    #                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;<br>    #                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;<br><br>    #access_log  logs/access.log  main;<br><br>    sendfile        on;<br>    #tcp_nopush     on;<br><br>    #keepalive_timeout  0;<br>    keepalive_timeout  65;<br><br>    #gzip  on;<br><br>    server &#123; # server块<br>        listen       80; # 目前监听端口号<br>        server_name  localhost; # 主机名称<br><br>        #charset koi8-r;<br><br>        #access_log  logs/host.access.log  main;<br><br>        location / &#123;<br>            root   html;<br>            index  index.html index.htm;<br>        &#125;<br><br>        #error_page  404              /404.html;<br><br>        # redirect server error pages to the static page /50x.html<br>        #<br>        error_page   500 502 503 504  /50x.html;<br>        location = /50x.html &#123;<br>            root   html;<br>        &#125;<br><br>        # proxy the PHP scripts to Apache listening on 127.0.0.1:80<br>        #<br>        #location ~ \.php$ &#123;<br>        #    proxy_pass   http://127.0.0.1;<br>        #&#125;<br><br>        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000<br>        #<br>        #location ~ \.php$ &#123;<br>        #    root           html;<br>        #    fastcgi_pass   127.0.0.1:9000;<br>        #    fastcgi_index  index.php;<br>        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;<br>        #    include        fastcgi_params;<br>        #&#125;<br><br>        # deny access to .htaccess files, if Apache&#x27;s document root<br>        # concurs with nginx&#x27;s one<br>        #<br>        #location ~ /\.ht &#123;<br>        #    deny  all;<br>        #&#125;<br>    &#125;<br><br><br>    # another virtual host using mix of IP-, name-, and port-based configuration<br>    #<br>    #server &#123;<br>    #    listen       8000;<br>    #    listen       somename:8080;<br>    #    server_name  somename  alias  another.alias;<br><br>    #    location / &#123;<br>    #        root   html;<br>    #        index  index.html index.htm;<br>    #    &#125;<br>    #&#125;<br><br><br>    # HTTPS server<br>    #<br>    #server &#123;<br>    #    listen       443 ssl;<br>    #    server_name  localhost;<br><br>    #    ssl_certificate      cert.pem;<br>    #    ssl_certificate_key  cert.key;<br><br>    #    ssl_session_cache    shared:SSL:1m;<br>    #    ssl_session_timeout  5m;<br><br>    #    ssl_ciphers  HIGH:!aNULL:!MD5;<br>    #    ssl_prefer_server_ciphers  on;<br><br>    #    location / &#123;<br>    #        root   html;<br>    #        index  index.html index.htm;<br>    #    &#125;<br>    #&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="location指令说明"><a href="#location指令说明" class="headerlink" title="location指令说明"></a>location指令说明</h4><p>该指令用于匹配URL</p>
<p>语法如下：</p>
<ol>
<li><code>=</code>: 用于不含正则表达式的URI前，要求请求字符串与URI严格匹配，如果匹配成功，就停止继续向下搜索并立即处理该请求</li>
<li><code>~</code>: 用于表示URI包含正则表达式，并且区分大小写</li>
<li><code>~*</code>: 用于表示URI包含正则表达式，并且不区分大小写</li>
<li><code>^~</code>: 用于不含正则表达式的URI前，要求Nginx服务器找到标识URI和请求字符串匹配度最高的location后，立即使用此location处理请求，而不再使用location块中的正则URI和请求字符串做匹配</li>
</ol>
<h2 id="操作实例"><a href="#操作实例" class="headerlink" title="操作实例"></a>操作实例</h2><h3 id="反向代理实例"><a href="#反向代理实例" class="headerlink" title="反向代理实例"></a>反向代理实例</h3><h4 id="实例一"><a href="#实例一" class="headerlink" title="实例一"></a>实例一</h4><p>实现效果：浏览器输入网址<a target="_blank" rel="noopener" href="http://www.123.com跳转到本地tomcat页面/">www.123.com跳转到本地Tomcat页面</a></p>
<p>下载并解压Tomcat，进入bin目录启动Tomcat</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">./startup.sh<br></code></pre></td></tr></table></figure>

<p>开放端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">sudo firewall-cmd --add-port=8080/tcp --permanent<br>firewall-cmd -reload<br>firewall-cmd --list-all<br></code></pre></td></tr></table></figure>

<p>修改配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs conf">server &#123;<br>    listen 80;<br>    server_name www.123.com;<br><br>    location / &#123;<br>        proxy_pass http://www.123.com:8080;<br>        index index.html index.htm index.jsp;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="实例二"><a href="#实例二" class="headerlink" title="实例二"></a>实例二</h4><p>实现效果：根据访问的路径跳转到不同端口的服务中</p>
<ul>
<li>访问<a target="_blank" rel="noopener" href="http://127.0.0.1:9001/edu">http://127.0.0.1:9001/edu</a> 直接跳转到127.0.0.1:8080</li>
<li>访问<a target="_blank" rel="noopener" href="http://127.0.0.1:9001/vod">http://127.0.0.1:9001/vod</a> 直接跳转到127.0.0.1:8081</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs conf">server &#123;<br>    listen 9001;<br>    server_name localhost;<br><br>    location ~ /edu/ &#123; # ~符号表示后接正则表达式，表示访问的路径中包含edu字符串就跳转到8080<br>        proxy_pass http://localhost:8080;<br>    &#125;<br>    location ~ /vod/ &#123;<br>        proxy_pass http://localhost:8081;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<h3 id="负载均衡实例"><a href="#负载均衡实例" class="headerlink" title="负载均衡实例"></a>负载均衡实例</h3><p>实现效果：通过浏览器的地址栏输入地址(<a target="_blank" rel="noopener" href="http://localhost/edu/a.html)%EF%BC%8C%E4%BD%BF%E5%BE%97%E8%AF%B7%E6%B1%82%E5%B9%B3%E5%9D%87%E5%88%86%E9%85%8D%E5%88%B08080%E4%B8%8E8081%E7%AB%AF%E5%8F%A3%E4%B8%AD">http://localhost/edu/a.html)，使得请求平均分配到8080与8081端口中</a></p>
<p>关键配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs conf">http &#123;<br>    #.....<br>    upstream myserver &#123;<br>        ip_hash;<br>        server 192.168.17.129:8080 weight=1;<br>        server 192.168.17.129:8081 weight=1;<br>    &#125;<br>    #.....<br>    server &#123;<br>        location / &#123;<br>            #.....<br>            proxy_pass http://myserver;<br>            proxy_connect_timeout 10;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>配置案例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs conf"><br>worker_processes  1;<br><br><br>events &#123;<br>    worker_connections  1024;<br>&#125;<br><br>http &#123;<br>    include       mime.types;<br>    default_type  application/octet-stream;<br><br>    sendfile        on;<br><br>    keepalive_timeout  65;<br><br>    upstream myserver &#123;<br>        ip_hash;<br>        server 192.168.17.129:8080 weight=1;<br>        server 192.168.17.129:8081 weight=1;<br>    &#125;<br><br>    server &#123;<br>        listen       80;<br>        server_name  192.168.17.129;<br><br>        location / &#123;<br>            proxy_pass http://myserver;<br>            proxy_connect_timeout 10;<br>            root   html<br>            index index.html index.htm<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h3 id="负载均衡的分配方式"><a href="#负载均衡的分配方式" class="headerlink" title="负载均衡的分配方式"></a>负载均衡的分配方式</h3><ol>
<li>轮询(默认)：每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器down掉，能自动剔除。</li>
<li>weight：权重，weight和访问比率成正比，用于后端服务器性能不均的情况，例如：<ul>
<li>A服务器<code>weight=5</code>，B服务器<code>weight=10</code>，则B会收到的流量为A的一倍，即A会收到全部流量的1&#x2F;3，B为2&#x2F;3</li>
</ul>
</li>
<li>ip_hash：每个请求按IP的hash结果分配，每个访客固定访问一个后端服务器，可以解决session的问题</li>
<li>fair: 按照后端服务器的访问时间来分配，时间短的优先分配</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs conf">upstream myserver &#123;<br>    server 192.168.17.129:8080;<br>    server 192.168.17.129:8081;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs conf">upstream myserver &#123;<br>    server 192.168.17.129:8080 weight=5;<br>    server 192.168.17.129:8081 weight=10;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs conf">upstream myserver &#123;<br>    ip_hash;<br>    server 192.168.17.129:8080;<br>    server 192.168.17.129:8081;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs conf">upstream myserver &#123;<br>    server 192.168.17.129:8080;<br>    server 192.168.17.129:8081;<br>    fair;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="动静分离实例"><a href="#动静分离实例" class="headerlink" title="动静分离实例"></a>动静分离实例</h3><p>通过<code>location</code>指定不同的后缀名实现不同的请求转发。通过<code>expires</code>参数设置，可以使浏览器缓存过期时间，减少与服务器之前的请求和流量。</p>
<p><code>Expores</code>：给一个资源设定一个过期时间，无需服务器端验证，而是由浏览器去确认该资源是否过期，不会产生额外的流量。适用于不经常变动的资源。比如设置为<code>3d</code>表示3天之内访问这个URL，浏览器会发送一个请求来对比服务器该文件最后更新时间有无变化，若无则不会从服务器抓取，返回状态码<code>304</code>，如果有修改则直接从服务器下载，返回状态码<code>200</code></p>
<p>实现效果：</p>
<ol>
<li>浏览器中输入地址<a target="_blank" rel="noopener" href="http://192.168.17.129/image/01.jpg">http://192.168.17.129/image/01.jpg</a></li>
<li>浏览器中输入地址<a target="_blank" rel="noopener" href="http://192.168.17.129/www/a.html">http://192.168.17.129/www/a.html</a></li>
</ol>
<p>文件结构：</p>
<ul>
<li>data<ul>
<li>image<ul>
<li>01.jpg</li>
</ul>
</li>
<li>www<ul>
<li>a.html</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs conf">worker_processes  1;<br><br><br>events &#123;<br>    worker_connections  1024;<br>&#125;<br><br>http &#123;<br>    include       mime.types;<br>    default_type  application/octet-stream;<br><br>    sendfile        on;<br><br>    keepalive_timeout  65;<br><br>    server &#123;<br>        listen       80;<br>        server_name  192.168.17.129;<br><br>        location /www/ &#123;<br>            root /data/;<br>            index index.html index.htm<br>        &#125;<br><br>        location /image/ &#123;<br>            root /data/;<br>            autoindex on; # 在浏览器中列出当前文件夹中的内容<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="高可用集群"><a href="#高可用集群" class="headerlink" title="高可用集群"></a>高可用集群</h2><p>多台Nginx同时工作，若其中一台宕机服务不会中断。</p>
<p>需要：</p>
<ol>
<li>2台服务器192.168.17.129, 192.168.17.131</li>
<li>两台服务器安装Nginx</li>
<li>两台服务器安装keepalived</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">yum install keepalived -y<br></code></pre></td></tr></table></figure>

<p>配置文件<code>/etc/keepalive.conf</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs conf">#全局配置<br>global_defs &#123; <br>    notification_email &#123;<br>        acassen@firewall.loc<br>        failover@firewall.loc<br>        sysadmin@firewall.loc<br>    &#125;<br>    notification_email from Alexandre.Cassen@firewall.loc<br>    smtp_server 192.168.17.129<br>    smtp_connect timeout 30<br>    router_id LVS_DEVEL # 唯一取值，可写服务器名字(配置在hosts里的domian)也可写IP<br>&#125;<br><br># 脚本配置<br>vrrp_script chk_http_port &#123;<br>    script &quot;/usr/local/src/nginx_check.sh&quot; # 检测脚本路径<br>    interval 2 # 检测脚本执行间隔<br>    weight 2 # 权重参数<br>&#125;<br><br>vrrp_instance VI_1 &#123;<br>    state BACKUP # 备份服务器上将MASTER改为BACKUP<br>    interface ens33 # 网卡<br>    virtual_router_id 51 # 主、备机的virtual_router_id 必须相同<br>    priority 100 # 主、备机取不同的优先级，主机值较大，备份机值较小<br>    advert_int 1 # 时间间隔，每隔多久发送一个心跳，单位秒<br>    authentication &#123; # 权限校验方式<br>        auth_type PASS # 类型：密码<br>        auth_pass 1111 # 密码值<br>    &#125;<br>    virtual_ipaddress &#123;<br>        192.168.17.50 # VRRP H虚拟地址<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>检测脚本<code>/usr/local/src/nginx_check.sh</code>：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br>A=`ps -C nginx -no-header |<span class="hljs-built_in">wc</span> -l`<br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$A</span> -eq 0 ]; <span class="hljs-keyword">then</span><br>    /usr/local/nginx/sbin/nginx<br>    <span class="hljs-built_in">sleep</span> 2<br>    <span class="hljs-keyword">if</span> [ `ps -C nginx -no-header |<span class="hljs-built_in">wc</span> -l` -eq 0 ]; <span class="hljs-keyword">then</span><br>        killall keepalived<br>    <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure>

<p>查看网卡名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">ifconfig<br></code></pre></td></tr></table></figure>

<h2 id="Nginx原理分析"><a href="#Nginx原理分析" class="headerlink" title="Nginx原理分析"></a>Nginx原理分析</h2><h3 id="master-和-worker"><a href="#master-和-worker" class="headerlink" title="master 和 worker"></a>master 和 worker</h3><p>Nginx启动之后在Linux系统中其实有两个进程，分别叫<code>nginx: master</code>, <code>nginx: worker</code></p>
<p>当客户端发送一条请求给master之后，然后由worker来争抢该条请求，当worker抢到之后变进行请求转发或反向代理给Tomcat来响应请求</p>
<p>一个master和多个worker的好处：</p>
<ol>
<li>可以使用<code>nginx -s reload</code>热部署。在进行热部署时，已经在执行任务的worker继续执行，没有任务的worker重新加载，有任务的worker任务执行完毕后再加载新配置文件。</li>
<li>对于每个worker进程来说，独立的进程，不需要加锁，所以省掉了锁带来的开销。</li>
<li>独立的进程互相之间不会相互影响，一个进程退出后，其它的进程还在工作，服务不会中断。若单个worker进程遇到异常退出了，会导致当前worker上的所有请求失败，不会影响到其它worker在处理的请求。</li>
</ol>
<h4 id="需要设置多少个worker"><a href="#需要设置多少个worker" class="headerlink" title="需要设置多少个worker"></a>需要设置多少个worker</h4><p>Nginx和redis类似都采用了io多路复用机制，每个worker都是一个独立的进程，但每个进程只有一个主线程，通过异步非阻塞的方式来处理请求。每个worker的线程可以把一个cpu的性能发挥到极致。所以worker数和服务器的cpu核数相等是最为适宜的。设少了浪费cpu，设多了会造成cpu频繁切换上下文带来的损耗。</p>
<h2 id="反向代理配置文件案例"><a href="#反向代理配置文件案例" class="headerlink" title="反向代理配置文件案例"></a>反向代理配置文件案例</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br></pre></td><td class="code"><pre><code class="hljs conf"><br>#user  nobody;<br>worker_processes  1; # nginx服务器并发处理关键配置，worker_processes值越大，可以支持的并发处理量越多，但是受硬件、软件等设备制约<br><br>#error_log  logs/error.log;<br>#error_log  logs/error.log  notice;<br>#error_log  logs/error.log  info;<br><br>#pid        logs/nginx.pid;<br><br><br>events &#123;<br>    worker_connections  1024; # 表示每个worker processes支持的最大连接数为1024<br>&#125;<br><br><br>http &#123;<br>    include       mime.types;<br>    default_type  application/octet-stream;<br><br>    #log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;<br>    #                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;<br>    #                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;<br><br>    #access_log  logs/access.log  main;<br><br>    sendfile        on;<br>    #tcp_nopush     on;<br><br>    #keepalive_timeout  0;<br>    keepalive_timeout  65;<br>    <br>    server_names_hash_max_size 512;<br>    server_names_hash_bucket_size 1024;<br><br>    #gzip  on;<br>    <br>    # upstream 负载均衡关键配置<br>    # The ngx_http_upstream_module module is used to define groups of servers that can be referenced by the proxy_pass, fastcgi_pass, uwsgi_pass, scgi_pass, memcached_pass, and grpc_pass directives.<br>    # 定义server用于给后面的proxy_pass使用<br>    # 参考：https://blog.csdn.net/caijunsen/article/details/83002219<br>    upstream www-pixiv-net &#123; <br>        # 每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器down掉，能自动剔除<br>        server 210.140.131.223:443;<br>        server 210.140.131.225:443;<br>        server 210.140.131.220:443;<br>    &#125;<br>    <br>    upstream sketch-pixiv-net &#123; <br>        server 210.140.174.37:443;<br>        server 210.140.170.179:443;<br>        server 210.140.175.130:443;<br>    &#125;<br>    <br>    upstream sketch-hls-server &#123;<br>        server 210.140.214.211:443;<br>        server 210.140.214.212:443;<br>        server 210.140.214.213:443;<br>    &#125;<br>    <br>    upstream imgaz-pixiv-net &#123; <br>        server 210.140.131.145:443;<br>        server 210.140.131.144:443;<br>        server 210.140.131.147:443;<br>        server 210.140.131.153:443;<br>    &#125;<br>    <br>    upstream i-pximg-net &#123; <br>        server 210.140.92.140:443;<br>        server 210.140.92.137:443;<br>        server 210.140.92.139:443;<br>        server 210.140.92.142:443;<br>        server 210.140.92.134:443;<br>        server 210.140.92.141:443;<br>        server 210.140.92.143:443;<br>        server 210.140.92.136:443; <br>        server 210.140.92.138:443;<br>	    server 210.140.92.144:443;<br>	    server 210.140.92.145:443;<br>    &#125;<br>    <br>    server &#123;<br>        listen 80 default_server; # default_server 指令可以定义默认的 server 去处理一些没有匹配到 server_name 的请求，如果没有显式定义，则会选取第一个定义的 server 作为 default_server<br>        rewrite ^(.*) https://$host$1 permanent; # 网站添加了https证书后，当http方式访问网站时就会报404错误，所以需要做http到https的强制跳转设置<br>        # rewrite语法：<br>        # rewrite    &lt;regex&gt;    &lt;replacement&gt;    [flag];<br>        # 关键字      正则        替代内容          flag标记<br>        # 关键字：其中关键字error_log不能改变<br>        # 正则：perl兼容正则表达式语句进行规则匹配<br>        # 替代内容：将正则匹配的内容替换成replacement<br>        # flag标记：rewrite支持的flag标记<br>        # flag标记说明：<br>        # last: 本条规则匹配完成后，继续向下匹配新的location URI规则<br>        # break: 本条规则匹配完成即终止，不再匹配后面的任何规则<br>        # redirect: 返回302临时重定向，浏览器地址会显示跳转后的URL地址<br>        # permanent: 返回301永久重定向，浏览器地址栏会显示跳转后的URL地址<br><br>        # rewrite的组要功能是实现URL地址的重定向。Nginx的rewrite功能需要PCRE软件的支持，即通过perl兼容正则表达式语句进行规则匹配的。默认参数编译nginx就会支持rewrite的模块，但是也必须要PCRE的支持<br>    &#125;<br><br>    server &#123;<br>        listen 443 ssl; # 443是https的默认端口<br>        server_name pixiv.net; # server name 为虚拟服务器的识别路径。因此不同的域名会通过请求头中的HOST字段，匹配到特定的server块，转发到对应的应用服务器中去<br>        server_name www.pixiv.net;<br>        server_name ssl.pixiv.net;<br>        server_name accounts.pixiv.net;<br>        server_name touch.pixiv.net;<br>        server_name oauth.secure.pixiv.net;<br><br>        ssl on; # 使用HTTPS，需要安装OpenSSL<br>        ssl_certificate ca/pixiv.net.crt;<br>        ssl_certificate_key ca/pixiv.net.key; # HTTPS私钥<br>        <br>        client_max_body_size 50M; # 用nginx作代理服务器，上传大文件的大小有限制(限制请求体的大小，若超过所设定的大小，返回413错误)<br>        <br>    	location / &#123;<br>            proxy_pass https://www-pixiv-net;<br>            proxy_set_header Host $http_host;<br>            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>            proxy_set_header X-Real_IP $remote_addr;<br>            proxy_set_header User-Agent $http_user_agent;<br>            proxy_set_header Accept-Encoding &#x27;&#x27;; <br>            proxy_buffering off; # 主要是实现被代理服务器的数据和客户端的请求异步<br>            # A为客户端，B为代理服务器，C为被代理服务器。<br>            # 当proxy_buffering开启，A发起请求到B，B再到C，C反馈的数据先到B的buffer上，<br>            # 然后B会根据proxy_busy_buffer_size来决定什么时候开始把数据传输给A。<br>            # 在此过程中，如果所有的buffer被写满，数据将会写入到temp_file中。<br>            # 相反，如果proxy_buffering关闭，C反馈的数据实时地通过B传输给A。<br>        &#125;<br>	&#125;<br>    <br>    server &#123;<br>        listen 443 ssl;<br>        server_name i.pximg.net;<br><br>        ssl on;<br>        ssl_certificate ca/pixiv.net.crt;<br>        ssl_certificate_key ca/pixiv.net.key;<br>        <br>    	location / &#123;<br>            proxy_pass https://i-pximg-net;<br>            proxy_set_header Host $http_host;<br>            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>            proxy_set_header X-Real_IP $remote_addr;<br>            proxy_set_header User-Agent $http_user_agent;<br>            proxy_set_header Accept-Encoding &#x27;&#x27;; <br>            proxy_buffering off;<br>        &#125;<br>	&#125;<br>    <br>    server &#123;<br>        listen 443 ssl;<br>        server_name sketch.pixiv.net;<br><br>        ssl on;<br>        ssl_certificate ca/pixiv.net.crt;<br>        ssl_certificate_key ca/pixiv.net.key;<br><br>    	location / &#123;<br>            proxy_pass https://sketch-pixiv-net;<br>            proxy_set_header Host $http_host;<br>            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>            proxy_set_header X-Real_IP $remote_addr;<br>            proxy_set_header User-Agent $http_user_agent;<br>            proxy_set_header Accept-Encoding &#x27;&#x27;; <br>            proxy_buffering off;<br>        &#125;<br>        <br>        # Proxying WebSockets<br>        location /ws/ &#123;<br>            proxy_pass https://sketch-pixiv-net;<br>            proxy_http_version 1.1;<br>            proxy_set_header Upgrade $http_upgrade;<br>            proxy_set_header Connection &quot;upgrade&quot;;<br>            proxy_set_header Host $host;<br>        &#125;<br>	&#125;<br>    <br>    server &#123;<br>        listen 443 ssl;<br>        server_name *.pixivsketch.net;<br><br>        ssl on;<br>        ssl_certificate ca/pixiv.net.crt;<br>        ssl_certificate_key ca/pixiv.net.key;<br><br>    	location / &#123;<br>            proxy_pass https://sketch-hls-server;<br>            proxy_set_header Host $http_host;<br>            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>            proxy_set_header X-Real_IP $remote_addr;<br>            proxy_set_header User-Agent $http_user_agent;<br>            proxy_set_header Accept-Encoding &#x27;&#x27;; <br>            proxy_buffering off;<br>        &#125;<br>	&#125;<br>    <br>    server &#123;<br>        listen 443 ssl;<br>        server_name factory.pixiv.net;<br><br>        ssl on;<br>        ssl_certificate ca/pixiv.net.crt;<br>        ssl_certificate_key ca/pixiv.net.key;<br><br>    	location / &#123;<br>            proxy_pass https://210.140.131.180/;<br>            proxy_set_header Host $http_host;<br>            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>            proxy_set_header X-Real_IP $remote_addr;<br>            proxy_set_header User-Agent $http_user_agent;<br>            proxy_set_header Accept-Encoding &#x27;&#x27;; <br>            proxy_buffering off;<br>        &#125;<br>	&#125;<br>    <br>    server &#123;<br>        listen 443 ssl;<br>        server_name dic.pixiv.net;<br>        server_name en-dic.pixiv.net;<br>        server_name sensei.pixiv.net;<br>        server_name fanbox.pixiv.net;<br>        server_name payment.pixiv.net.pixiv.net;<br><br>        ssl on;<br>        ssl_certificate ca/pixiv.net.crt;<br>        ssl_certificate_key ca/pixiv.net.key;<br>        <br>    	location / &#123;<br>            proxy_pass https://210.140.131.222/;<br>            proxy_set_header Host $http_host;<br>            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>            proxy_set_header X-Real_IP $remote_addr;<br>            proxy_set_header User-Agent $http_user_agent;<br>            proxy_set_header Accept-Encoding &#x27;&#x27;; <br>            proxy_buffering off;<br>        &#125;<br>	&#125;<br>    <br>    server &#123;<br>        listen 443 ssl;<br>        server_name imgaz.pixiv.net;<br>        server_name comic.pixiv.net;<br>        server_name novel.pixiv.net;<br>        server_name source.pixiv.net;<br>        server_name i1.pixiv.net;<br>        server_name i2.pixiv.net;<br>        server_name i3.pixiv.net;<br>        server_name i4.pixiv.net;<br><br>        ssl on;<br>        ssl_certificate ca/pixiv.net.crt;<br>        ssl_certificate_key ca/pixiv.net.key;<br>        <br>    	location / &#123;<br>            proxy_pass https://imgaz-pixiv-net;<br>            proxy_set_header Host $http_host;<br>            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>            proxy_set_header X-Real_IP $remote_addr;<br>            proxy_set_header User-Agent $http_user_agent;<br>            proxy_set_header Accept-Encoding &#x27;&#x27;; <br>            proxy_buffering off;<br>        &#125;<br>	&#125;<br><br>    upstream wikipedia-server &#123; <br>        server 198.35.26.96:443;<br>        server 103.102.166.224:443;<br>    &#125;<br>    <br>    server &#123;<br>        listen 443 ssl;<br>        server_name *.wikipedia.org;<br>        server_name *.m.wikipedia.org;<br><br>        ssl on;<br>        ssl_certificate ca/pixiv.net.crt;<br>        ssl_certificate_key ca/pixiv.net.key;<br>        <br>    	location / &#123;<br>            proxy_pass https://wikipedia-server/;<br>            proxy_set_header Host $http_host;<br>            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>            proxy_set_header X-Real_IP $remote_addr;<br>            proxy_set_header User-Agent $http_user_agent;<br>            proxy_set_header Accept-Encoding &#x27;&#x27;; <br>            proxy_buffering off;<br>        &#125;<br>	&#125;<br>    <br>    server &#123;<br>        listen 443 ssl;<br>        server_name *.steamcommunity.com;<br>        server_name steamcommunity.com;<br><br>        ssl on;<br>        ssl_certificate ca/pixiv.net.crt;<br>        ssl_certificate_key ca/pixiv.net.key;<br>        <br>    	location / &#123;<br>            proxy_pass https://23.61.176.149/;<br>            proxy_set_header Host $http_host;<br>            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>            proxy_set_header X-Real_IP $remote_addr;<br>            proxy_set_header User-Agent $http_user_agent;<br>            proxy_set_header Accept-Encoding &#x27;&#x27;; <br>            proxy_buffering off;<br>        &#125;<br>	&#125;<br>    <br>    server &#123;<br>        listen 443 ssl;<br>        server_name *.steampowered.com;<br>        server_name steampowered.com;<br><br>        ssl on;<br>        ssl_certificate ca/pixiv.net.crt;<br>        ssl_certificate_key ca/pixiv.net.key;<br>        <br>    	location / &#123;<br>            proxy_pass https://104.112.84.145/;<br>            proxy_set_header Host $http_host;<br>            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>            proxy_set_header X-Real_IP $remote_addr;<br>            proxy_set_header User-Agent $http_user_agent;<br>            proxy_set_header Accept-Encoding &#x27;&#x27;; <br>            proxy_buffering off;<br>        &#125;<br>	&#125;<br>	    server &#123;<br>        listen 443 ssl;<br>        server_name *.archiveofourown.org;<br>        server_name archiveofourown.org;<br><br>        ssl on;<br>        ssl_certificate ca/pixiv.net.crt;<br>        ssl_certificate_key ca/pixiv.net.key;<br>        <br>    	location / &#123;<br>            proxy_pass https://104.153.64.122/;<br>            proxy_set_header Host $http_host;<br>            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>            proxy_set_header X-Real_IP $remote_addr;<br>            proxy_set_header User-Agent $http_user_agent;<br>            proxy_set_header Accept-Encoding &#x27;&#x27;; <br>            proxy_buffering off;<br>        &#125;<br>	&#125;<br>    <br>&#125;<br><br></code></pre></td></tr></table></figure>

<h2 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tools/nginx">The easiest way to configure a performant, secure, and stable NGINX server.</a></li>
<li><a target="_blank" rel="noopener" href="https://2heng.xin/2017/09/19/pixiv/">PIXIV网页版及客户端访问恢复指南</a></li>
<li><a target="_blank" rel="noopener" href="http://idayer.com/nginx-reverse-proxy-for-pixiv/">MAC本地nginx反向代理访问Pixiv指北</a></li>
<li><a target="_blank" rel="noopener" href="https://moe.best/technology/pixiv-proxy.html">Nginx 真·反代P站 恢复直接访问</a></li>
<li><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tools/nginx">NGINX Config The easiest way to configure a performant, secure, and stable NGINX server.</a></li>
<li></li>
</ul>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2020/05/12/SpringBoot/Spring%E6%B3%A8%E8%A7%A3%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/">← Next Spring注解驱动开发</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2020/03/23/SpringBoot/SpringBoot-%E5%8E%9F%E7%90%86%E5%88%9D%E6%8E%A2/">SpringBoot-原理初探 Prev →</a></div></div></div><div id="comments"><div class="selector"><button class="gitalk-sel"></button></div><div id="gitalk"></div></div></div><div class="bottom-btn"><div><a id="to-top" onClick="scrolls.scrolltop();" title="回到顶部" style="opacity: 0; display: none;">∧</a><a id="to-index" href="#toc-div" title="文章目录">≡</a><a id="color-mode" onClick="colorMode.change()" title="切换主题"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">Sicmatr1x</a></h1><div id="description"><p>INTP/Traveller/Stoicism/Crypto-anarchism/Minimalism/Cosmopolitanism/English learner/Crypto/Java Engineer</p></div></div><div id="aside-block"><div id="toc-div"><h1>目录</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">1.</span> <span class="toc-text">基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-number">1.1.</span> <span class="toc-text">反向代理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-number">1.1.1.</span> <span class="toc-text">正向代理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86-1"><span class="toc-number">1.1.2.</span> <span class="toc-text">反向代理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">1.2.</span> <span class="toc-text">负载均衡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB"><span class="toc-number">1.3.</span> <span class="toc-text">动静分离</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="toc-number">1.4.</span> <span class="toc-text">高可用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#install"><span class="toc-number">2.</span> <span class="toc-text">install</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96"><span class="toc-number">2.1.</span> <span class="toc-text">安装依赖</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#pcre"><span class="toc-number">2.1.1.</span> <span class="toc-text">pcre</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#zlib%E4%B8%8Eopenssl"><span class="toc-number">2.1.2.</span> <span class="toc-text">zlib与openssl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%88%96%E8%80%85%E4%BD%BF%E7%94%A8yum%E4%B8%80%E9%94%AE%E5%AE%89%E8%A3%85%E4%B8%8A%E8%BF%B03%E4%B8%AA%E4%BE%9D%E8%B5%96"><span class="toc-number">2.1.3.</span> <span class="toc-text">或者使用yum一键安装上述3个依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-nginx"><span class="toc-number">2.1.4.</span> <span class="toc-text">安装 nginx</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">3.1.</span> <span class="toc-text">测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E9%98%B2%E7%81%AB%E5%A2%99"><span class="toc-number">3.2.</span> <span class="toc-text">配置防火墙</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nginx-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">4.</span> <span class="toc-text">nginx 常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8Bnginx%E7%89%88%E6%9C%AC%E5%8F%B7"><span class="toc-number">4.0.1.</span> <span class="toc-text">查看nginx版本号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8nginx"><span class="toc-number">4.0.2.</span> <span class="toc-text">启动nginx</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E9%97%ADnginx"><span class="toc-number">4.0.3.</span> <span class="toc-text">关闭nginx</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E6%96%B0%E5%8A%A0%E8%BD%BDnginx"><span class="toc-number">4.0.4.</span> <span class="toc-text">重新加载nginx</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6nginx-conf"><span class="toc-number">5.</span> <span class="toc-text">配置文件nginx.conf</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%9D%97"><span class="toc-number">5.1.</span> <span class="toc-text">全局块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#events%E5%9D%97"><span class="toc-number">5.2.</span> <span class="toc-text">events块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http%E5%9D%97"><span class="toc-number">5.3.</span> <span class="toc-text">http块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#location%E6%8C%87%E4%BB%A4%E8%AF%B4%E6%98%8E"><span class="toc-number">5.3.1.</span> <span class="toc-text">location指令说明</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E5%AE%9E%E4%BE%8B"><span class="toc-number">6.</span> <span class="toc-text">操作实例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%AE%9E%E4%BE%8B"><span class="toc-number">6.1.</span> <span class="toc-text">反向代理实例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B%E4%B8%80"><span class="toc-number">6.1.1.</span> <span class="toc-text">实例一</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B%E4%BA%8C"><span class="toc-number">6.1.2.</span> <span class="toc-text">实例二</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E4%BE%8B"><span class="toc-number">6.2.</span> <span class="toc-text">负载均衡实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%9A%84%E5%88%86%E9%85%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">6.3.</span> <span class="toc-text">负载均衡的分配方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB%E5%AE%9E%E4%BE%8B"><span class="toc-number">6.4.</span> <span class="toc-text">动静分离实例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4"><span class="toc-number">7.</span> <span class="toc-text">高可用集群</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"><span class="toc-number">8.</span> <span class="toc-text">Nginx原理分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#master-%E5%92%8C-worker"><span class="toc-number">8.1.</span> <span class="toc-text">master 和 worker</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E8%A6%81%E8%AE%BE%E7%BD%AE%E5%A4%9A%E5%B0%91%E4%B8%AAworker"><span class="toc-number">8.1.1.</span> <span class="toc-text">需要设置多少个worker</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%A1%88%E4%BE%8B"><span class="toc-number">9.</span> <span class="toc-text">反向代理配置文件案例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%93%BE%E6%8E%A5"><span class="toc-number">10.</span> <span class="toc-text">链接</span></a></li></ol></div></div><footer><nobr>构建自 <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> 使用主题 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>主题作者 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script class="pjax-js">reset=_=>{gitalk = new Gitalk({
 clientID: '',
 clientSecret: '',
 repo: 'blog-comments',
 owner: 'Sicmatr1x',
 admin: ['Sicmatr1x'],
 distractionFreeMode: false,
 id: 
});
if (document.querySelector("#gitalk")) gitalk.render("gitalk");code.findCode();}</script><script src="/js/arknights.js"></script><script src="/js/pjax.js"></script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>